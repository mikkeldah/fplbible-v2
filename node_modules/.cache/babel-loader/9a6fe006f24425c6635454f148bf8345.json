{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar rgba = require('color-rgba');\n\nvar Axes = require('../../plots/cartesian/axes');\n\nvar Lib = require('../../lib');\n\nvar strRotate = Lib.strRotate;\nvar strTranslate = Lib.strTranslate;\n\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar Drawing = require('../../components/drawing');\n\nvar Colorscale = require('../../components/colorscale');\n\nvar gup = require('../../lib/gup');\n\nvar keyFun = gup.keyFun;\nvar repeat = gup.repeat;\nvar unwrap = gup.unwrap;\n\nvar helpers = require('./helpers');\n\nvar c = require('./constants');\n\nvar brush = require('./axisbrush');\n\nvar lineLayerMaker = require('./lines');\n\nfunction findExtreme(fn, values, len) {\n  return Lib.aggNums(fn, null, values, len);\n}\n\nfunction findExtremes(values, len) {\n  return fixExtremes(findExtreme(Math.min, values, len), findExtreme(Math.max, values, len));\n}\n\nfunction dimensionExtent(dimension) {\n  var range = dimension.range;\n  return range ? fixExtremes(range[0], range[1]) : findExtremes(dimension.values, dimension._length);\n}\n\nfunction fixExtremes(lo, hi) {\n  if (isNaN(lo) || !isFinite(lo)) {\n    lo = 0;\n  }\n\n  if (isNaN(hi) || !isFinite(hi)) {\n    hi = 0;\n  } // avoid a degenerate (zero-width) domain\n\n\n  if (lo === hi) {\n    if (lo === 0) {\n      // no use to multiplying zero, so add/subtract in this case\n      lo -= 1;\n      hi += 1;\n    } else {\n      // this keeps the range in the order of magnitude of the data\n      lo *= 0.9;\n      hi *= 1.1;\n    }\n  }\n\n  return [lo, hi];\n}\n\nfunction toText(formatter, texts) {\n  if (texts) {\n    return function (v, i) {\n      var text = texts[i];\n      if (text === null || text === undefined) return formatter(v);\n      return text;\n    };\n  }\n\n  return formatter;\n}\n\nfunction domainScale(height, padding, dimension, tickvals, ticktext) {\n  var extent = dimensionExtent(dimension);\n\n  if (tickvals) {\n    return d3.scale.ordinal().domain(tickvals.map(toText(d3.format(dimension.tickformat), ticktext))).range(tickvals.map(function (d) {\n      var unitVal = (d - extent[0]) / (extent[1] - extent[0]);\n      return height - padding + unitVal * (2 * padding - height);\n    }));\n  }\n\n  return d3.scale.linear().domain(extent).range([height - padding, padding]);\n}\n\nfunction unitToPaddedPx(height, padding) {\n  return d3.scale.linear().range([padding, height - padding]);\n}\n\nfunction domainToPaddedUnitScale(dimension, padFraction) {\n  return d3.scale.linear().domain(dimensionExtent(dimension)).range([padFraction, 1 - padFraction]);\n}\n\nfunction ordinalScale(dimension) {\n  if (!dimension.tickvals) return;\n  var extent = dimensionExtent(dimension);\n  return d3.scale.ordinal().domain(dimension.tickvals).range(dimension.tickvals.map(function (d) {\n    return (d - extent[0]) / (extent[1] - extent[0]);\n  }));\n}\n\nfunction unitToColorScale(cscale) {\n  var colorStops = cscale.map(function (d) {\n    return d[0];\n  });\n  var colorTuples = cscale.map(function (d) {\n    var RGBA = rgba(d[1]);\n    return d3.rgb('rgb(' + RGBA[0] + ',' + RGBA[1] + ',' + RGBA[2] + ')');\n  });\n\n  var prop = function (n) {\n    return function (o) {\n      return o[n];\n    };\n  }; // We can't use d3 color interpolation as we may have non-uniform color palette raster\n  // (various color stop distances).\n\n\n  var polylinearUnitScales = 'rgb'.split('').map(function (key) {\n    return d3.scale.linear().clamp(true).domain(colorStops).range(colorTuples.map(prop(key)));\n  });\n  return function (d) {\n    return polylinearUnitScales.map(function (s) {\n      return s(d);\n    });\n  };\n}\n\nfunction someFiltersActive(view) {\n  return view.dimensions.some(function (p) {\n    return p.brush.filterSpecified;\n  });\n}\n\nfunction model(layout, d, i) {\n  var cd0 = unwrap(d);\n  var trace = cd0.trace;\n  var lineColor = helpers.convertTypedArray(cd0.lineColor);\n  var line = trace.line;\n  var deselectedLines = {\n    color: rgba(c.deselectedLineColor)\n  };\n  var cOpts = Colorscale.extractOpts(line);\n  var cscale = cOpts.reversescale ? Colorscale.flipScale(cd0.cscale) : cd0.cscale;\n  var domain = trace.domain;\n  var dimensions = trace.dimensions;\n  var width = layout.width;\n  var labelAngle = trace.labelangle;\n  var labelSide = trace.labelside;\n  var labelFont = trace.labelfont;\n  var tickFont = trace.tickfont;\n  var rangeFont = trace.rangefont;\n  var lines = Lib.extendDeepNoArrays({}, line, {\n    color: lineColor.map(d3.scale.linear().domain(dimensionExtent({\n      values: lineColor,\n      range: [cOpts.min, cOpts.max],\n      _length: trace._length\n    }))),\n    blockLineCount: c.blockLineCount,\n    canvasOverdrag: c.overdrag * c.canvasPixelRatio\n  });\n  var groupWidth = Math.floor(width * (domain.x[1] - domain.x[0]));\n  var groupHeight = Math.floor(layout.height * (domain.y[1] - domain.y[0]));\n  var pad = layout.margin || {\n    l: 80,\n    r: 80,\n    t: 100,\n    b: 80\n  };\n  var rowContentWidth = groupWidth;\n  var rowHeight = groupHeight;\n  return {\n    key: i,\n    colCount: dimensions.filter(helpers.isVisible).length,\n    dimensions: dimensions,\n    tickDistance: c.tickDistance,\n    unitToColor: unitToColorScale(cscale),\n    lines: lines,\n    deselectedLines: deselectedLines,\n    labelAngle: labelAngle,\n    labelSide: labelSide,\n    labelFont: labelFont,\n    tickFont: tickFont,\n    rangeFont: rangeFont,\n    layoutWidth: width,\n    layoutHeight: layout.height,\n    domain: domain,\n    translateX: domain.x[0] * width,\n    translateY: layout.height - domain.y[1] * layout.height,\n    pad: pad,\n    canvasWidth: rowContentWidth * c.canvasPixelRatio + 2 * lines.canvasOverdrag,\n    canvasHeight: rowHeight * c.canvasPixelRatio,\n    width: rowContentWidth,\n    height: rowHeight,\n    canvasPixelRatio: c.canvasPixelRatio\n  };\n}\n\nfunction viewModel(state, callbacks, model) {\n  var width = model.width;\n  var height = model.height;\n  var dimensions = model.dimensions;\n  var canvasPixelRatio = model.canvasPixelRatio;\n\n  var xScale = function (d) {\n    return width * d / Math.max(1, model.colCount - 1);\n  };\n\n  var unitPad = c.verticalPadding / height;\n\n  var _unitToPaddedPx = unitToPaddedPx(height, c.verticalPadding);\n\n  var vm = {\n    key: model.key,\n    xScale: xScale,\n    model: model,\n    inBrushDrag: false // consider factoring it out and putting it in a centralized global-ish gesture state object\n\n  };\n  var uniqueKeys = {};\n  vm.dimensions = dimensions.filter(helpers.isVisible).map(function (dimension, i) {\n    var domainToPaddedUnit = domainToPaddedUnitScale(dimension, unitPad);\n    var foundKey = uniqueKeys[dimension.label];\n    uniqueKeys[dimension.label] = (foundKey || 0) + 1;\n    var key = dimension.label + (foundKey ? '__' + foundKey : '');\n    var specifiedConstraint = dimension.constraintrange;\n    var filterRangeSpecified = specifiedConstraint && specifiedConstraint.length;\n\n    if (filterRangeSpecified && !Array.isArray(specifiedConstraint[0])) {\n      specifiedConstraint = [specifiedConstraint];\n    }\n\n    var filterRange = filterRangeSpecified ? specifiedConstraint.map(function (d) {\n      return d.map(domainToPaddedUnit);\n    }) : [[-Infinity, Infinity]];\n\n    var brushMove = function () {\n      var p = vm;\n      p.focusLayer && p.focusLayer.render(p.panels, true);\n      var filtersActive = someFiltersActive(p);\n\n      if (!state.contextShown() && filtersActive) {\n        p.contextLayer && p.contextLayer.render(p.panels, true);\n        state.contextShown(true);\n      } else if (state.contextShown() && !filtersActive) {\n        p.contextLayer && p.contextLayer.render(p.panels, true, true);\n        state.contextShown(false);\n      }\n    };\n\n    var truncatedValues = dimension.values;\n\n    if (truncatedValues.length > dimension._length) {\n      truncatedValues = truncatedValues.slice(0, dimension._length);\n    }\n\n    var tickvals = dimension.tickvals;\n    var ticktext;\n\n    function makeTickItem(v, i) {\n      return {\n        val: v,\n        text: ticktext[i]\n      };\n    }\n\n    function sortTickItem(a, b) {\n      return a.val - b.val;\n    }\n\n    if (Array.isArray(tickvals) && tickvals.length) {\n      ticktext = dimension.ticktext; // ensure ticktext and tickvals have same length\n\n      if (!Array.isArray(ticktext) || !ticktext.length) {\n        ticktext = tickvals.map(d3.format(dimension.tickformat));\n      } else if (ticktext.length > tickvals.length) {\n        ticktext = ticktext.slice(0, tickvals.length);\n      } else if (tickvals.length > ticktext.length) {\n        tickvals = tickvals.slice(0, ticktext.length);\n      } // check if we need to sort tickvals/ticktext\n\n\n      for (var j = 1; j < tickvals.length; j++) {\n        if (tickvals[j] < tickvals[j - 1]) {\n          var tickItems = tickvals.map(makeTickItem).sort(sortTickItem);\n\n          for (var k = 0; k < tickvals.length; k++) {\n            tickvals[k] = tickItems[k].val;\n            ticktext[k] = tickItems[k].text;\n          }\n\n          break;\n        }\n      }\n    } else tickvals = undefined;\n\n    truncatedValues = helpers.convertTypedArray(truncatedValues);\n    return {\n      key: key,\n      label: dimension.label,\n      tickFormat: dimension.tickformat,\n      tickvals: tickvals,\n      ticktext: ticktext,\n      ordinal: helpers.isOrdinal(dimension),\n      multiselect: dimension.multiselect,\n      xIndex: i,\n      crossfilterDimensionIndex: i,\n      visibleIndex: dimension._index,\n      height: height,\n      values: truncatedValues,\n      paddedUnitValues: truncatedValues.map(domainToPaddedUnit),\n      unitTickvals: tickvals && tickvals.map(domainToPaddedUnit),\n      xScale: xScale,\n      x: xScale(i),\n      canvasX: xScale(i) * canvasPixelRatio,\n      unitToPaddedPx: _unitToPaddedPx,\n      domainScale: domainScale(height, c.verticalPadding, dimension, tickvals, ticktext),\n      ordinalScale: ordinalScale(dimension),\n      parent: vm,\n      model: model,\n      brush: brush.makeBrush(state, filterRangeSpecified, filterRange, function () {\n        state.linePickActive(false);\n      }, brushMove, function (f) {\n        vm.focusLayer.render(vm.panels, true);\n        vm.pickLayer && vm.pickLayer.render(vm.panels, true);\n        state.linePickActive(true);\n\n        if (callbacks && callbacks.filterChanged) {\n          var invScale = domainToPaddedUnit.invert; // update gd.data as if a Plotly.restyle were fired\n\n          var newRanges = f.map(function (r) {\n            return r.map(invScale).sort(Lib.sorterAsc);\n          }).sort(function (a, b) {\n            return a[0] - b[0];\n          });\n          callbacks.filterChanged(vm.key, dimension._index, newRanges);\n        }\n      })\n    };\n  });\n  return vm;\n}\n\nfunction styleExtentTexts(selection) {\n  selection.classed(c.cn.axisExtentText, true).attr('text-anchor', 'middle').style('cursor', 'default');\n}\n\nfunction parcoordsInteractionState() {\n  var linePickActive = true;\n  var contextShown = false;\n  return {\n    linePickActive: function (val) {\n      return arguments.length ? linePickActive = !!val : linePickActive;\n    },\n    contextShown: function (val) {\n      return arguments.length ? contextShown = !!val : contextShown;\n    }\n  };\n}\n\nfunction calcTilt(angle, position) {\n  var dir = position === 'top' ? 1 : -1;\n  var radians = angle * Math.PI / 180;\n  var dx = Math.sin(radians);\n  var dy = Math.cos(radians);\n  return {\n    dir: dir,\n    dx: dx,\n    dy: dy,\n    degrees: angle\n  };\n}\n\nfunction updatePanelLayout(yAxis, vm) {\n  var panels = vm.panels || (vm.panels = []);\n  var data = yAxis.data();\n\n  for (var i = 0; i < data.length - 1; i++) {\n    var p = panels[i] || (panels[i] = {});\n    var dim0 = data[i];\n    var dim1 = data[i + 1];\n    p.dim0 = dim0;\n    p.dim1 = dim1;\n    p.canvasX = dim0.canvasX;\n    p.panelSizeX = dim1.canvasX - dim0.canvasX;\n    p.panelSizeY = vm.model.canvasHeight;\n    p.y = 0;\n    p.canvasY = 0;\n  }\n}\n\nfunction calcAllTicks(cd) {\n  for (var i = 0; i < cd.length; i++) {\n    for (var j = 0; j < cd[i].length; j++) {\n      var trace = cd[i][j].trace;\n      var dimensions = trace.dimensions;\n\n      for (var k = 0; k < dimensions.length; k++) {\n        var values = dimensions[k].values;\n        var dim = dimensions[k]._ax;\n\n        if (dim) {\n          if (!dim.range) {\n            dim.range = findExtremes(values, trace._length);\n          } else {\n            dim.range = fixExtremes(dim.range[0], dim.range[1]);\n          }\n\n          if (!dim.dtick) {\n            dim.dtick = 0.01 * (Math.abs(dim.range[1] - dim.range[0]) || 1);\n          }\n\n          dim.tickformat = dimensions[k].tickformat;\n          Axes.calcTicks(dim);\n          dim.cleanRange();\n        }\n      }\n    }\n  }\n}\n\nfunction linearFormat(dim, v) {\n  return Axes.tickText(dim._ax, v, false).text;\n}\n\nfunction extremeText(d, isTop) {\n  if (d.ordinal) return '';\n  var domain = d.domainScale.domain();\n  var v = domain[isTop ? domain.length - 1 : 0];\n  return linearFormat(d.model.dimensions[d.visibleIndex], v);\n}\n\nmodule.exports = function parcoords(gd, cdModule, layout, callbacks) {\n  var fullLayout = gd._fullLayout;\n  var svg = fullLayout._toppaper;\n  var glContainer = fullLayout._glcontainer;\n  var paperColor = gd._fullLayout.paper_bgcolor;\n  calcAllTicks(cdModule);\n  var state = parcoordsInteractionState();\n  var vm = cdModule.filter(function (d) {\n    return unwrap(d).trace.visible;\n  }).map(model.bind(0, layout)).map(viewModel.bind(0, state, callbacks));\n  glContainer.each(function (d, i) {\n    return Lib.extendFlat(d, vm[i]);\n  });\n  var glLayers = glContainer.selectAll('.gl-canvas').each(function (d) {\n    // FIXME: figure out how to handle multiple instances\n    d.viewModel = vm[0];\n    d.viewModel.paperColor = paperColor;\n    d.model = d.viewModel ? d.viewModel.model : null;\n  });\n  var lastHovered = null;\n  var pickLayer = glLayers.filter(function (d) {\n    return d.pick;\n  }); // emit hover / unhover event\n\n  pickLayer.style('pointer-events', 'auto').on('mousemove', function (d) {\n    if (state.linePickActive() && d.lineLayer && callbacks && callbacks.hover) {\n      var event = d3.event;\n      var cw = this.width;\n      var ch = this.height;\n      var pointer = d3.mouse(this);\n      var x = pointer[0];\n      var y = pointer[1];\n\n      if (x < 0 || y < 0 || x >= cw || y >= ch) {\n        return;\n      }\n\n      var pixel = d.lineLayer.readPixel(x, ch - 1 - y);\n      var found = pixel[3] !== 0; // inverse of the calcPickColor in `lines.js`; detailed comment there\n\n      var curveNumber = found ? pixel[2] + 256 * (pixel[1] + 256 * pixel[0]) : null;\n      var eventData = {\n        x: x,\n        y: y,\n        clientX: event.clientX,\n        clientY: event.clientY,\n        dataIndex: d.model.key,\n        curveNumber: curveNumber\n      };\n\n      if (curveNumber !== lastHovered) {\n        // don't unnecessarily repeat the same hit (or miss)\n        if (found) {\n          callbacks.hover(eventData);\n        } else if (callbacks.unhover) {\n          callbacks.unhover(eventData);\n        }\n\n        lastHovered = curveNumber;\n      }\n    }\n  });\n  glLayers.style('opacity', function (d) {\n    return d.pick ? 0 : 1;\n  });\n  svg.style('background', 'rgba(255, 255, 255, 0)');\n  var controlOverlay = svg.selectAll('.' + c.cn.parcoords).data(vm, keyFun);\n  controlOverlay.exit().remove();\n  controlOverlay.enter().append('g').classed(c.cn.parcoords, true).style('shape-rendering', 'crispEdges').style('pointer-events', 'none');\n  controlOverlay.attr('transform', function (d) {\n    return strTranslate(d.model.translateX, d.model.translateY);\n  });\n  var parcoordsControlView = controlOverlay.selectAll('.' + c.cn.parcoordsControlView).data(repeat, keyFun);\n  parcoordsControlView.enter().append('g').classed(c.cn.parcoordsControlView, true);\n  parcoordsControlView.attr('transform', function (d) {\n    return strTranslate(d.model.pad.l, d.model.pad.t);\n  });\n  var yAxis = parcoordsControlView.selectAll('.' + c.cn.yAxis).data(function (p) {\n    return p.dimensions;\n  }, keyFun);\n  yAxis.enter().append('g').classed(c.cn.yAxis, true);\n  parcoordsControlView.each(function (p) {\n    updatePanelLayout(yAxis, p);\n  });\n  glLayers.each(function (d) {\n    if (d.viewModel) {\n      if (!d.lineLayer || callbacks) {\n        // recreate in case of having callbacks e.g. restyle. Should we test for callback to be a restyle?\n        d.lineLayer = lineLayerMaker(this, d);\n      } else d.lineLayer.update(d);\n\n      if (d.key || d.key === 0) d.viewModel[d.key] = d.lineLayer;\n      var setChanged = !d.context || // don't update background\n      callbacks; // unless there is a callback on the context layer. Should we test the callback?\n\n      d.lineLayer.render(d.viewModel.panels, setChanged);\n    }\n  });\n  yAxis.attr('transform', function (d) {\n    return strTranslate(d.xScale(d.xIndex), 0);\n  }); // drag column for reordering columns\n\n  yAxis.call(d3.behavior.drag().origin(function (d) {\n    return d;\n  }).on('drag', function (d) {\n    var p = d.parent;\n    state.linePickActive(false);\n    d.x = Math.max(-c.overdrag, Math.min(d.model.width + c.overdrag, d3.event.x));\n    d.canvasX = d.x * d.model.canvasPixelRatio;\n    yAxis.sort(function (a, b) {\n      return a.x - b.x;\n    }).each(function (e, i) {\n      e.xIndex = i;\n      e.x = d === e ? e.x : e.xScale(e.xIndex);\n      e.canvasX = e.x * e.model.canvasPixelRatio;\n    });\n    updatePanelLayout(yAxis, p);\n    yAxis.filter(function (e) {\n      return Math.abs(d.xIndex - e.xIndex) !== 0;\n    }).attr('transform', function (d) {\n      return strTranslate(d.xScale(d.xIndex), 0);\n    });\n    d3.select(this).attr('transform', strTranslate(d.x, 0));\n    yAxis.each(function (e, i0, i1) {\n      if (i1 === d.parent.key) p.dimensions[i0] = e;\n    });\n    p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n    p.focusLayer.render && p.focusLayer.render(p.panels);\n  }).on('dragend', function (d) {\n    var p = d.parent;\n    d.x = d.xScale(d.xIndex);\n    d.canvasX = d.x * d.model.canvasPixelRatio;\n    updatePanelLayout(yAxis, p);\n    d3.select(this).attr('transform', function (d) {\n      return strTranslate(d.x, 0);\n    });\n    p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n    p.focusLayer && p.focusLayer.render(p.panels);\n    p.pickLayer && p.pickLayer.render(p.panels, true);\n    state.linePickActive(true);\n\n    if (callbacks && callbacks.axesMoved) {\n      callbacks.axesMoved(p.key, p.dimensions.map(function (e) {\n        return e.crossfilterDimensionIndex;\n      }));\n    }\n  }));\n  yAxis.exit().remove();\n  var axisOverlays = yAxis.selectAll('.' + c.cn.axisOverlays).data(repeat, keyFun);\n  axisOverlays.enter().append('g').classed(c.cn.axisOverlays, true);\n  axisOverlays.selectAll('.' + c.cn.axis).remove();\n  var axis = axisOverlays.selectAll('.' + c.cn.axis).data(repeat, keyFun);\n  axis.enter().append('g').classed(c.cn.axis, true);\n  axis.each(function (d) {\n    var wantedTickCount = d.model.height / d.model.tickDistance;\n    var scale = d.domainScale;\n    var sdom = scale.domain();\n    d3.select(this).call(d3.svg.axis().orient('left').tickSize(4).outerTickSize(2).ticks(wantedTickCount, d.tickFormat) // works for continuous scales only...\n    .tickValues(d.ordinal ? // and this works for ordinal scales\n    sdom : null).tickFormat(function (v) {\n      return helpers.isOrdinal(d) ? v : linearFormat(d.model.dimensions[d.visibleIndex], v);\n    }).scale(scale));\n    Drawing.font(axis.selectAll('text'), d.model.tickFont);\n  });\n  axis.selectAll('.domain, .tick>line').attr('fill', 'none').attr('stroke', 'black').attr('stroke-opacity', 0.25).attr('stroke-width', '1px');\n  axis.selectAll('text').style('text-shadow', svgTextUtils.makeTextShadow(paperColor)).style('cursor', 'default');\n  var axisHeading = axisOverlays.selectAll('.' + c.cn.axisHeading).data(repeat, keyFun);\n  axisHeading.enter().append('g').classed(c.cn.axisHeading, true);\n  var axisTitle = axisHeading.selectAll('.' + c.cn.axisTitle).data(repeat, keyFun);\n  axisTitle.enter().append('text').classed(c.cn.axisTitle, true).attr('text-anchor', 'middle').style('cursor', 'ew-resize').style('pointer-events', 'auto');\n  axisTitle.text(function (d) {\n    return d.label;\n  }).each(function (d) {\n    var e = d3.select(this);\n    Drawing.font(e, d.model.labelFont);\n    svgTextUtils.convertToTspans(e, gd);\n  }).attr('transform', function (d) {\n    var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n    var r = c.axisTitleOffset;\n    return (tilt.dir > 0 ? '' : strTranslate(0, 2 * r + d.model.height)) + strRotate(tilt.degrees) + strTranslate(-r * tilt.dx, -r * tilt.dy);\n  }).attr('text-anchor', function (d) {\n    var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n    var adx = Math.abs(tilt.dx);\n    var ady = Math.abs(tilt.dy);\n\n    if (2 * adx > ady) {\n      return tilt.dir * tilt.dx < 0 ? 'start' : 'end';\n    } else {\n      return 'middle';\n    }\n  });\n  var axisExtent = axisOverlays.selectAll('.' + c.cn.axisExtent).data(repeat, keyFun);\n  axisExtent.enter().append('g').classed(c.cn.axisExtent, true);\n  var axisExtentTop = axisExtent.selectAll('.' + c.cn.axisExtentTop).data(repeat, keyFun);\n  axisExtentTop.enter().append('g').classed(c.cn.axisExtentTop, true);\n  axisExtentTop.attr('transform', strTranslate(0, -c.axisExtentOffset));\n  var axisExtentTopText = axisExtentTop.selectAll('.' + c.cn.axisExtentTopText).data(repeat, keyFun);\n  axisExtentTopText.enter().append('text').classed(c.cn.axisExtentTopText, true).call(styleExtentTexts);\n  axisExtentTopText.text(function (d) {\n    return extremeText(d, true);\n  }).each(function (d) {\n    Drawing.font(d3.select(this), d.model.rangeFont);\n  });\n  var axisExtentBottom = axisExtent.selectAll('.' + c.cn.axisExtentBottom).data(repeat, keyFun);\n  axisExtentBottom.enter().append('g').classed(c.cn.axisExtentBottom, true);\n  axisExtentBottom.attr('transform', function (d) {\n    return strTranslate(0, d.model.height + c.axisExtentOffset);\n  });\n  var axisExtentBottomText = axisExtentBottom.selectAll('.' + c.cn.axisExtentBottomText).data(repeat, keyFun);\n  axisExtentBottomText.enter().append('text').classed(c.cn.axisExtentBottomText, true).attr('dy', '0.75em').call(styleExtentTexts);\n  axisExtentBottomText.text(function (d) {\n    return extremeText(d, false);\n  }).each(function (d) {\n    Drawing.font(d3.select(this), d.model.rangeFont);\n  });\n  brush.ensureAxisBrush(axisOverlays, paperColor);\n};","map":{"version":3,"sources":["C:/Users/mikke/VSC/fantasy-django-react/fantasy-django/fantasy-react-app/node_modules/plotly.js/src/traces/parcoords/parcoords.js"],"names":["d3","require","rgba","Axes","Lib","strRotate","strTranslate","svgTextUtils","Drawing","Colorscale","gup","keyFun","repeat","unwrap","helpers","c","brush","lineLayerMaker","findExtreme","fn","values","len","aggNums","findExtremes","fixExtremes","Math","min","max","dimensionExtent","dimension","range","_length","lo","hi","isNaN","isFinite","toText","formatter","texts","v","i","text","undefined","domainScale","height","padding","tickvals","ticktext","extent","scale","ordinal","domain","map","format","tickformat","d","unitVal","linear","unitToPaddedPx","domainToPaddedUnitScale","padFraction","ordinalScale","unitToColorScale","cscale","colorStops","colorTuples","RGBA","rgb","prop","n","o","polylinearUnitScales","split","key","clamp","s","someFiltersActive","view","dimensions","some","p","filterSpecified","model","layout","cd0","trace","lineColor","convertTypedArray","line","deselectedLines","color","deselectedLineColor","cOpts","extractOpts","reversescale","flipScale","width","labelAngle","labelangle","labelSide","labelside","labelFont","labelfont","tickFont","tickfont","rangeFont","rangefont","lines","extendDeepNoArrays","blockLineCount","canvasOverdrag","overdrag","canvasPixelRatio","groupWidth","floor","x","groupHeight","y","pad","margin","l","r","t","b","rowContentWidth","rowHeight","colCount","filter","isVisible","length","tickDistance","unitToColor","layoutWidth","layoutHeight","translateX","translateY","canvasWidth","canvasHeight","viewModel","state","callbacks","xScale","unitPad","verticalPadding","_unitToPaddedPx","vm","inBrushDrag","uniqueKeys","domainToPaddedUnit","foundKey","label","specifiedConstraint","constraintrange","filterRangeSpecified","Array","isArray","filterRange","Infinity","brushMove","focusLayer","render","panels","filtersActive","contextShown","contextLayer","truncatedValues","slice","makeTickItem","val","sortTickItem","a","j","tickItems","sort","k","tickFormat","isOrdinal","multiselect","xIndex","crossfilterDimensionIndex","visibleIndex","_index","paddedUnitValues","unitTickvals","canvasX","parent","makeBrush","linePickActive","f","pickLayer","filterChanged","invScale","invert","newRanges","sorterAsc","styleExtentTexts","selection","classed","cn","axisExtentText","attr","style","parcoordsInteractionState","arguments","calcTilt","angle","position","dir","radians","PI","dx","sin","dy","cos","degrees","updatePanelLayout","yAxis","data","dim0","dim1","panelSizeX","panelSizeY","canvasY","calcAllTicks","cd","dim","_ax","dtick","abs","calcTicks","cleanRange","linearFormat","tickText","extremeText","isTop","module","exports","parcoords","gd","cdModule","fullLayout","_fullLayout","svg","_toppaper","glContainer","_glcontainer","paperColor","paper_bgcolor","visible","bind","each","extendFlat","glLayers","selectAll","lastHovered","pick","on","lineLayer","hover","event","cw","ch","pointer","mouse","pixel","readPixel","found","curveNumber","eventData","clientX","clientY","dataIndex","unhover","controlOverlay","exit","remove","enter","append","parcoordsControlView","update","setChanged","context","call","behavior","drag","origin","e","select","i0","i1","axesMoved","axisOverlays","axis","wantedTickCount","sdom","orient","tickSize","outerTickSize","ticks","tickValues","font","makeTextShadow","axisHeading","axisTitle","convertToTspans","tilt","axisTitleOffset","adx","ady","axisExtent","axisExtentTop","axisExtentOffset","axisExtentTopText","axisExtentBottom","axisExtentBottomText","ensureAxisBrush"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar d3 = require('@plotly/d3');\r\nvar rgba = require('color-rgba');\r\n\r\nvar Axes = require('../../plots/cartesian/axes');\r\nvar Lib = require('../../lib');\r\nvar strRotate = Lib.strRotate;\r\nvar strTranslate = Lib.strTranslate;\r\nvar svgTextUtils = require('../../lib/svg_text_utils');\r\nvar Drawing = require('../../components/drawing');\r\nvar Colorscale = require('../../components/colorscale');\r\n\r\nvar gup = require('../../lib/gup');\r\nvar keyFun = gup.keyFun;\r\nvar repeat = gup.repeat;\r\nvar unwrap = gup.unwrap;\r\n\r\nvar helpers = require('./helpers');\r\nvar c = require('./constants');\r\nvar brush = require('./axisbrush');\r\nvar lineLayerMaker = require('./lines');\r\n\r\nfunction findExtreme(fn, values, len) {\r\n    return Lib.aggNums(fn, null, values, len);\r\n}\r\n\r\nfunction findExtremes(values, len) {\r\n    return fixExtremes(\r\n        findExtreme(Math.min, values, len),\r\n        findExtreme(Math.max, values, len)\r\n    );\r\n}\r\n\r\nfunction dimensionExtent(dimension) {\r\n    var range = dimension.range;\r\n    return range ?\r\n        fixExtremes(range[0], range[1]) :\r\n        findExtremes(dimension.values, dimension._length);\r\n}\r\n\r\nfunction fixExtremes(lo, hi) {\r\n    if(isNaN(lo) || !isFinite(lo)) {\r\n        lo = 0;\r\n    }\r\n\r\n    if(isNaN(hi) || !isFinite(hi)) {\r\n        hi = 0;\r\n    }\r\n\r\n    // avoid a degenerate (zero-width) domain\r\n    if(lo === hi) {\r\n        if(lo === 0) {\r\n            // no use to multiplying zero, so add/subtract in this case\r\n            lo -= 1;\r\n            hi += 1;\r\n        } else {\r\n            // this keeps the range in the order of magnitude of the data\r\n            lo *= 0.9;\r\n            hi *= 1.1;\r\n        }\r\n    }\r\n\r\n    return [lo, hi];\r\n}\r\n\r\nfunction toText(formatter, texts) {\r\n    if(texts) {\r\n        return function(v, i) {\r\n            var text = texts[i];\r\n            if(text === null || text === undefined) return formatter(v);\r\n            return text;\r\n        };\r\n    }\r\n    return formatter;\r\n}\r\n\r\nfunction domainScale(height, padding, dimension, tickvals, ticktext) {\r\n    var extent = dimensionExtent(dimension);\r\n    if(tickvals) {\r\n        return d3.scale.ordinal()\r\n            .domain(tickvals.map(toText(d3.format(dimension.tickformat), ticktext)))\r\n            .range(tickvals\r\n                .map(function(d) {\r\n                    var unitVal = (d - extent[0]) / (extent[1] - extent[0]);\r\n                    return (height - padding + unitVal * (2 * padding - height));\r\n                })\r\n            );\r\n    }\r\n    return d3.scale.linear()\r\n        .domain(extent)\r\n        .range([height - padding, padding]);\r\n}\r\n\r\nfunction unitToPaddedPx(height, padding) {\r\n    return d3.scale.linear().range([padding, height - padding]);\r\n}\r\n\r\nfunction domainToPaddedUnitScale(dimension, padFraction) {\r\n    return d3.scale.linear()\r\n        .domain(dimensionExtent(dimension))\r\n        .range([padFraction, 1 - padFraction]);\r\n}\r\n\r\nfunction ordinalScale(dimension) {\r\n    if(!dimension.tickvals) return;\r\n\r\n    var extent = dimensionExtent(dimension);\r\n    return d3.scale.ordinal()\r\n        .domain(dimension.tickvals)\r\n        .range(dimension.tickvals.map(function(d) {\r\n            return (d - extent[0]) / (extent[1] - extent[0]);\r\n        }));\r\n}\r\n\r\nfunction unitToColorScale(cscale) {\r\n    var colorStops = cscale.map(function(d) { return d[0]; });\r\n    var colorTuples = cscale.map(function(d) {\r\n        var RGBA = rgba(d[1]);\r\n        return d3.rgb('rgb(' + RGBA[0] + ',' + RGBA[1] + ',' + RGBA[2] + ')');\r\n    });\r\n    var prop = function(n) { return function(o) { return o[n]; }; };\r\n\r\n    // We can't use d3 color interpolation as we may have non-uniform color palette raster\r\n    // (various color stop distances).\r\n    var polylinearUnitScales = 'rgb'.split('').map(function(key) {\r\n        return d3.scale.linear()\r\n            .clamp(true)\r\n            .domain(colorStops)\r\n            .range(colorTuples.map(prop(key)));\r\n    });\r\n\r\n    return function(d) {\r\n        return polylinearUnitScales.map(function(s) {\r\n            return s(d);\r\n        });\r\n    };\r\n}\r\n\r\nfunction someFiltersActive(view) {\r\n    return view.dimensions.some(function(p) {\r\n        return p.brush.filterSpecified;\r\n    });\r\n}\r\n\r\nfunction model(layout, d, i) {\r\n    var cd0 = unwrap(d);\r\n    var trace = cd0.trace;\r\n    var lineColor = helpers.convertTypedArray(cd0.lineColor);\r\n    var line = trace.line;\r\n    var deselectedLines = {color: rgba(c.deselectedLineColor)};\r\n    var cOpts = Colorscale.extractOpts(line);\r\n    var cscale = cOpts.reversescale ? Colorscale.flipScale(cd0.cscale) : cd0.cscale;\r\n    var domain = trace.domain;\r\n    var dimensions = trace.dimensions;\r\n    var width = layout.width;\r\n    var labelAngle = trace.labelangle;\r\n    var labelSide = trace.labelside;\r\n    var labelFont = trace.labelfont;\r\n    var tickFont = trace.tickfont;\r\n    var rangeFont = trace.rangefont;\r\n\r\n    var lines = Lib.extendDeepNoArrays({}, line, {\r\n        color: lineColor.map(d3.scale.linear().domain(\r\n            dimensionExtent({\r\n                values: lineColor,\r\n                range: [cOpts.min, cOpts.max],\r\n                _length: trace._length\r\n            })\r\n        )),\r\n        blockLineCount: c.blockLineCount,\r\n        canvasOverdrag: c.overdrag * c.canvasPixelRatio\r\n    });\r\n\r\n    var groupWidth = Math.floor(width * (domain.x[1] - domain.x[0]));\r\n    var groupHeight = Math.floor(layout.height * (domain.y[1] - domain.y[0]));\r\n\r\n    var pad = layout.margin || {l: 80, r: 80, t: 100, b: 80};\r\n    var rowContentWidth = groupWidth;\r\n    var rowHeight = groupHeight;\r\n\r\n    return {\r\n        key: i,\r\n        colCount: dimensions.filter(helpers.isVisible).length,\r\n        dimensions: dimensions,\r\n        tickDistance: c.tickDistance,\r\n        unitToColor: unitToColorScale(cscale),\r\n        lines: lines,\r\n        deselectedLines: deselectedLines,\r\n        labelAngle: labelAngle,\r\n        labelSide: labelSide,\r\n        labelFont: labelFont,\r\n        tickFont: tickFont,\r\n        rangeFont: rangeFont,\r\n        layoutWidth: width,\r\n        layoutHeight: layout.height,\r\n        domain: domain,\r\n        translateX: domain.x[0] * width,\r\n        translateY: layout.height - domain.y[1] * layout.height,\r\n        pad: pad,\r\n        canvasWidth: rowContentWidth * c.canvasPixelRatio + 2 * lines.canvasOverdrag,\r\n        canvasHeight: rowHeight * c.canvasPixelRatio,\r\n        width: rowContentWidth,\r\n        height: rowHeight,\r\n        canvasPixelRatio: c.canvasPixelRatio\r\n    };\r\n}\r\n\r\nfunction viewModel(state, callbacks, model) {\r\n    var width = model.width;\r\n    var height = model.height;\r\n    var dimensions = model.dimensions;\r\n    var canvasPixelRatio = model.canvasPixelRatio;\r\n\r\n    var xScale = function(d) {return width * d / Math.max(1, model.colCount - 1);};\r\n\r\n    var unitPad = c.verticalPadding / height;\r\n    var _unitToPaddedPx = unitToPaddedPx(height, c.verticalPadding);\r\n\r\n    var vm = {\r\n        key: model.key,\r\n        xScale: xScale,\r\n        model: model,\r\n        inBrushDrag: false // consider factoring it out and putting it in a centralized global-ish gesture state object\r\n    };\r\n\r\n    var uniqueKeys = {};\r\n\r\n    vm.dimensions = dimensions.filter(helpers.isVisible).map(function(dimension, i) {\r\n        var domainToPaddedUnit = domainToPaddedUnitScale(dimension, unitPad);\r\n        var foundKey = uniqueKeys[dimension.label];\r\n        uniqueKeys[dimension.label] = (foundKey || 0) + 1;\r\n        var key = dimension.label + (foundKey ? '__' + foundKey : '');\r\n        var specifiedConstraint = dimension.constraintrange;\r\n        var filterRangeSpecified = specifiedConstraint && specifiedConstraint.length;\r\n        if(filterRangeSpecified && !Array.isArray(specifiedConstraint[0])) {\r\n            specifiedConstraint = [specifiedConstraint];\r\n        }\r\n        var filterRange = filterRangeSpecified ?\r\n            specifiedConstraint.map(function(d) { return d.map(domainToPaddedUnit); }) :\r\n            [[-Infinity, Infinity]];\r\n        var brushMove = function() {\r\n            var p = vm;\r\n            p.focusLayer && p.focusLayer.render(p.panels, true);\r\n            var filtersActive = someFiltersActive(p);\r\n            if(!state.contextShown() && filtersActive) {\r\n                p.contextLayer && p.contextLayer.render(p.panels, true);\r\n                state.contextShown(true);\r\n            } else if(state.contextShown() && !filtersActive) {\r\n                p.contextLayer && p.contextLayer.render(p.panels, true, true);\r\n                state.contextShown(false);\r\n            }\r\n        };\r\n\r\n        var truncatedValues = dimension.values;\r\n        if(truncatedValues.length > dimension._length) {\r\n            truncatedValues = truncatedValues.slice(0, dimension._length);\r\n        }\r\n\r\n        var tickvals = dimension.tickvals;\r\n        var ticktext;\r\n        function makeTickItem(v, i) { return {val: v, text: ticktext[i]}; }\r\n        function sortTickItem(a, b) { return a.val - b.val; }\r\n        if(Array.isArray(tickvals) && tickvals.length) {\r\n            ticktext = dimension.ticktext;\r\n\r\n            // ensure ticktext and tickvals have same length\r\n            if(!Array.isArray(ticktext) || !ticktext.length) {\r\n                ticktext = tickvals.map(d3.format(dimension.tickformat));\r\n            } else if(ticktext.length > tickvals.length) {\r\n                ticktext = ticktext.slice(0, tickvals.length);\r\n            } else if(tickvals.length > ticktext.length) {\r\n                tickvals = tickvals.slice(0, ticktext.length);\r\n            }\r\n\r\n            // check if we need to sort tickvals/ticktext\r\n            for(var j = 1; j < tickvals.length; j++) {\r\n                if(tickvals[j] < tickvals[j - 1]) {\r\n                    var tickItems = tickvals.map(makeTickItem).sort(sortTickItem);\r\n                    for(var k = 0; k < tickvals.length; k++) {\r\n                        tickvals[k] = tickItems[k].val;\r\n                        ticktext[k] = tickItems[k].text;\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        } else tickvals = undefined;\r\n\r\n        truncatedValues = helpers.convertTypedArray(truncatedValues);\r\n\r\n        return {\r\n            key: key,\r\n            label: dimension.label,\r\n            tickFormat: dimension.tickformat,\r\n            tickvals: tickvals,\r\n            ticktext: ticktext,\r\n            ordinal: helpers.isOrdinal(dimension),\r\n            multiselect: dimension.multiselect,\r\n            xIndex: i,\r\n            crossfilterDimensionIndex: i,\r\n            visibleIndex: dimension._index,\r\n            height: height,\r\n            values: truncatedValues,\r\n            paddedUnitValues: truncatedValues.map(domainToPaddedUnit),\r\n            unitTickvals: tickvals && tickvals.map(domainToPaddedUnit),\r\n            xScale: xScale,\r\n            x: xScale(i),\r\n            canvasX: xScale(i) * canvasPixelRatio,\r\n            unitToPaddedPx: _unitToPaddedPx,\r\n            domainScale: domainScale(height, c.verticalPadding, dimension, tickvals, ticktext),\r\n            ordinalScale: ordinalScale(dimension),\r\n            parent: vm,\r\n            model: model,\r\n            brush: brush.makeBrush(\r\n                state,\r\n                filterRangeSpecified,\r\n                filterRange,\r\n                function() {\r\n                    state.linePickActive(false);\r\n                },\r\n                brushMove,\r\n                function(f) {\r\n                    vm.focusLayer.render(vm.panels, true);\r\n                    vm.pickLayer && vm.pickLayer.render(vm.panels, true);\r\n                    state.linePickActive(true);\r\n                    if(callbacks && callbacks.filterChanged) {\r\n                        var invScale = domainToPaddedUnit.invert;\r\n\r\n                        // update gd.data as if a Plotly.restyle were fired\r\n                        var newRanges = f.map(function(r) {\r\n                            return r.map(invScale).sort(Lib.sorterAsc);\r\n                        }).sort(function(a, b) { return a[0] - b[0]; });\r\n                        callbacks.filterChanged(vm.key, dimension._index, newRanges);\r\n                    }\r\n                }\r\n            )\r\n        };\r\n    });\r\n\r\n    return vm;\r\n}\r\n\r\nfunction styleExtentTexts(selection) {\r\n    selection\r\n        .classed(c.cn.axisExtentText, true)\r\n        .attr('text-anchor', 'middle')\r\n        .style('cursor', 'default');\r\n}\r\n\r\nfunction parcoordsInteractionState() {\r\n    var linePickActive = true;\r\n    var contextShown = false;\r\n    return {\r\n        linePickActive: function(val) {return arguments.length ? linePickActive = !!val : linePickActive;},\r\n        contextShown: function(val) {return arguments.length ? contextShown = !!val : contextShown;}\r\n    };\r\n}\r\n\r\nfunction calcTilt(angle, position) {\r\n    var dir = (position === 'top') ? 1 : -1;\r\n    var radians = angle * Math.PI / 180;\r\n    var dx = Math.sin(radians);\r\n    var dy = Math.cos(radians);\r\n    return {\r\n        dir: dir,\r\n        dx: dx,\r\n        dy: dy,\r\n        degrees: angle\r\n    };\r\n}\r\n\r\nfunction updatePanelLayout(yAxis, vm) {\r\n    var panels = vm.panels || (vm.panels = []);\r\n    var data = yAxis.data();\r\n    for(var i = 0; i < data.length - 1; i++) {\r\n        var p = panels[i] || (panels[i] = {});\r\n        var dim0 = data[i];\r\n        var dim1 = data[i + 1];\r\n        p.dim0 = dim0;\r\n        p.dim1 = dim1;\r\n        p.canvasX = dim0.canvasX;\r\n        p.panelSizeX = dim1.canvasX - dim0.canvasX;\r\n        p.panelSizeY = vm.model.canvasHeight;\r\n        p.y = 0;\r\n        p.canvasY = 0;\r\n    }\r\n}\r\n\r\nfunction calcAllTicks(cd) {\r\n    for(var i = 0; i < cd.length; i++) {\r\n        for(var j = 0; j < cd[i].length; j++) {\r\n            var trace = cd[i][j].trace;\r\n            var dimensions = trace.dimensions;\r\n\r\n            for(var k = 0; k < dimensions.length; k++) {\r\n                var values = dimensions[k].values;\r\n                var dim = dimensions[k]._ax;\r\n\r\n                if(dim) {\r\n                    if(!dim.range) {\r\n                        dim.range = findExtremes(values, trace._length);\r\n                    } else {\r\n                        dim.range = fixExtremes(dim.range[0], dim.range[1]);\r\n                    }\r\n\r\n                    if(!dim.dtick) {\r\n                        dim.dtick = 0.01 * (Math.abs(dim.range[1] - dim.range[0]) || 1);\r\n                    }\r\n\r\n                    dim.tickformat = dimensions[k].tickformat;\r\n                    Axes.calcTicks(dim);\r\n                    dim.cleanRange();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction linearFormat(dim, v) {\r\n    return Axes.tickText(dim._ax, v, false).text;\r\n}\r\n\r\nfunction extremeText(d, isTop) {\r\n    if(d.ordinal) return '';\r\n    var domain = d.domainScale.domain();\r\n    var v = (domain[isTop ? domain.length - 1 : 0]);\r\n\r\n    return linearFormat(d.model.dimensions[d.visibleIndex], v);\r\n}\r\n\r\n\r\nmodule.exports = function parcoords(gd, cdModule, layout, callbacks) {\r\n    var fullLayout = gd._fullLayout;\r\n    var svg = fullLayout._toppaper;\r\n    var glContainer = fullLayout._glcontainer;\r\n    var paperColor = gd._fullLayout.paper_bgcolor;\r\n\r\n    calcAllTicks(cdModule);\r\n\r\n    var state = parcoordsInteractionState();\r\n\r\n    var vm = cdModule\r\n        .filter(function(d) { return unwrap(d).trace.visible; })\r\n        .map(model.bind(0, layout))\r\n        .map(viewModel.bind(0, state, callbacks));\r\n\r\n    glContainer.each(function(d, i) {\r\n        return Lib.extendFlat(d, vm[i]);\r\n    });\r\n\r\n    var glLayers = glContainer.selectAll('.gl-canvas')\r\n        .each(function(d) {\r\n            // FIXME: figure out how to handle multiple instances\r\n            d.viewModel = vm[0];\r\n            d.viewModel.paperColor = paperColor;\r\n            d.model = d.viewModel ? d.viewModel.model : null;\r\n        });\r\n\r\n    var lastHovered = null;\r\n\r\n    var pickLayer = glLayers.filter(function(d) {return d.pick;});\r\n\r\n    // emit hover / unhover event\r\n    pickLayer\r\n        .style('pointer-events', 'auto')\r\n        .on('mousemove', function(d) {\r\n            if(state.linePickActive() && d.lineLayer && callbacks && callbacks.hover) {\r\n                var event = d3.event;\r\n                var cw = this.width;\r\n                var ch = this.height;\r\n                var pointer = d3.mouse(this);\r\n                var x = pointer[0];\r\n                var y = pointer[1];\r\n\r\n                if(x < 0 || y < 0 || x >= cw || y >= ch) {\r\n                    return;\r\n                }\r\n                var pixel = d.lineLayer.readPixel(x, ch - 1 - y);\r\n                var found = pixel[3] !== 0;\r\n                // inverse of the calcPickColor in `lines.js`; detailed comment there\r\n                var curveNumber = found ? pixel[2] + 256 * (pixel[1] + 256 * pixel[0]) : null;\r\n                var eventData = {\r\n                    x: x,\r\n                    y: y,\r\n                    clientX: event.clientX,\r\n                    clientY: event.clientY,\r\n                    dataIndex: d.model.key,\r\n                    curveNumber: curveNumber\r\n                };\r\n                if(curveNumber !== lastHovered) { // don't unnecessarily repeat the same hit (or miss)\r\n                    if(found) {\r\n                        callbacks.hover(eventData);\r\n                    } else if(callbacks.unhover) {\r\n                        callbacks.unhover(eventData);\r\n                    }\r\n                    lastHovered = curveNumber;\r\n                }\r\n            }\r\n        });\r\n\r\n    glLayers\r\n        .style('opacity', function(d) {return d.pick ? 0 : 1;});\r\n\r\n    svg.style('background', 'rgba(255, 255, 255, 0)');\r\n    var controlOverlay = svg.selectAll('.' + c.cn.parcoords)\r\n        .data(vm, keyFun);\r\n\r\n    controlOverlay.exit().remove();\r\n\r\n    controlOverlay.enter()\r\n        .append('g')\r\n        .classed(c.cn.parcoords, true)\r\n        .style('shape-rendering', 'crispEdges')\r\n        .style('pointer-events', 'none');\r\n\r\n    controlOverlay.attr('transform', function(d) {\r\n        return strTranslate(d.model.translateX, d.model.translateY);\r\n    });\r\n\r\n    var parcoordsControlView = controlOverlay.selectAll('.' + c.cn.parcoordsControlView)\r\n        .data(repeat, keyFun);\r\n\r\n    parcoordsControlView.enter()\r\n        .append('g')\r\n        .classed(c.cn.parcoordsControlView, true);\r\n\r\n    parcoordsControlView.attr('transform', function(d) {\r\n        return strTranslate(d.model.pad.l, d.model.pad.t);\r\n    });\r\n\r\n    var yAxis = parcoordsControlView.selectAll('.' + c.cn.yAxis)\r\n        .data(function(p) { return p.dimensions; }, keyFun);\r\n\r\n    yAxis.enter()\r\n        .append('g')\r\n        .classed(c.cn.yAxis, true);\r\n\r\n    parcoordsControlView.each(function(p) {\r\n        updatePanelLayout(yAxis, p);\r\n    });\r\n\r\n    glLayers\r\n        .each(function(d) {\r\n            if(d.viewModel) {\r\n                if(!d.lineLayer || callbacks) { // recreate in case of having callbacks e.g. restyle. Should we test for callback to be a restyle?\r\n                    d.lineLayer = lineLayerMaker(this, d);\r\n                } else d.lineLayer.update(d);\r\n\r\n                if(d.key || d.key === 0) d.viewModel[d.key] = d.lineLayer;\r\n\r\n                var setChanged = (!d.context || // don't update background\r\n                                  callbacks);   // unless there is a callback on the context layer. Should we test the callback?\r\n\r\n                d.lineLayer.render(d.viewModel.panels, setChanged);\r\n            }\r\n        });\r\n\r\n    yAxis.attr('transform', function(d) {\r\n        return strTranslate(d.xScale(d.xIndex), 0);\r\n    });\r\n\r\n    // drag column for reordering columns\r\n    yAxis.call(d3.behavior.drag()\r\n        .origin(function(d) { return d; })\r\n        .on('drag', function(d) {\r\n            var p = d.parent;\r\n            state.linePickActive(false);\r\n            d.x = Math.max(-c.overdrag, Math.min(d.model.width + c.overdrag, d3.event.x));\r\n            d.canvasX = d.x * d.model.canvasPixelRatio;\r\n            yAxis\r\n                .sort(function(a, b) { return a.x - b.x; })\r\n                .each(function(e, i) {\r\n                    e.xIndex = i;\r\n                    e.x = d === e ? e.x : e.xScale(e.xIndex);\r\n                    e.canvasX = e.x * e.model.canvasPixelRatio;\r\n                });\r\n\r\n            updatePanelLayout(yAxis, p);\r\n\r\n            yAxis.filter(function(e) { return Math.abs(d.xIndex - e.xIndex) !== 0; })\r\n                .attr('transform', function(d) { return strTranslate(d.xScale(d.xIndex), 0); });\r\n            d3.select(this).attr('transform', strTranslate(d.x, 0));\r\n            yAxis.each(function(e, i0, i1) { if(i1 === d.parent.key) p.dimensions[i0] = e; });\r\n            p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\r\n            p.focusLayer.render && p.focusLayer.render(p.panels);\r\n        })\r\n        .on('dragend', function(d) {\r\n            var p = d.parent;\r\n            d.x = d.xScale(d.xIndex);\r\n            d.canvasX = d.x * d.model.canvasPixelRatio;\r\n            updatePanelLayout(yAxis, p);\r\n            d3.select(this)\r\n                .attr('transform', function(d) { return strTranslate(d.x, 0); });\r\n            p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\r\n            p.focusLayer && p.focusLayer.render(p.panels);\r\n            p.pickLayer && p.pickLayer.render(p.panels, true);\r\n            state.linePickActive(true);\r\n\r\n            if(callbacks && callbacks.axesMoved) {\r\n                callbacks.axesMoved(p.key, p.dimensions.map(function(e) {return e.crossfilterDimensionIndex;}));\r\n            }\r\n        })\r\n    );\r\n\r\n    yAxis.exit()\r\n        .remove();\r\n\r\n    var axisOverlays = yAxis.selectAll('.' + c.cn.axisOverlays)\r\n        .data(repeat, keyFun);\r\n\r\n    axisOverlays.enter()\r\n        .append('g')\r\n        .classed(c.cn.axisOverlays, true);\r\n\r\n    axisOverlays.selectAll('.' + c.cn.axis).remove();\r\n\r\n    var axis = axisOverlays.selectAll('.' + c.cn.axis)\r\n        .data(repeat, keyFun);\r\n\r\n    axis.enter()\r\n        .append('g')\r\n        .classed(c.cn.axis, true);\r\n\r\n    axis\r\n        .each(function(d) {\r\n            var wantedTickCount = d.model.height / d.model.tickDistance;\r\n            var scale = d.domainScale;\r\n            var sdom = scale.domain();\r\n            d3.select(this)\r\n                .call(d3.svg.axis()\r\n                    .orient('left')\r\n                    .tickSize(4)\r\n                    .outerTickSize(2)\r\n                    .ticks(wantedTickCount, d.tickFormat) // works for continuous scales only...\r\n                    .tickValues(d.ordinal ? // and this works for ordinal scales\r\n                        sdom :\r\n                        null)\r\n                    .tickFormat(function(v) {\r\n                        return helpers.isOrdinal(d) ? v : linearFormat(d.model.dimensions[d.visibleIndex], v);\r\n                    })\r\n                    .scale(scale));\r\n            Drawing.font(axis.selectAll('text'), d.model.tickFont);\r\n        });\r\n\r\n    axis.selectAll('.domain, .tick>line')\r\n        .attr('fill', 'none')\r\n        .attr('stroke', 'black')\r\n        .attr('stroke-opacity', 0.25)\r\n        .attr('stroke-width', '1px');\r\n\r\n    axis.selectAll('text')\r\n        .style('text-shadow', svgTextUtils.makeTextShadow(paperColor))\r\n        .style('cursor', 'default');\r\n\r\n    var axisHeading = axisOverlays.selectAll('.' + c.cn.axisHeading)\r\n        .data(repeat, keyFun);\r\n\r\n    axisHeading.enter()\r\n        .append('g')\r\n        .classed(c.cn.axisHeading, true);\r\n\r\n    var axisTitle = axisHeading.selectAll('.' + c.cn.axisTitle)\r\n        .data(repeat, keyFun);\r\n\r\n    axisTitle.enter()\r\n        .append('text')\r\n        .classed(c.cn.axisTitle, true)\r\n        .attr('text-anchor', 'middle')\r\n        .style('cursor', 'ew-resize')\r\n        .style('pointer-events', 'auto');\r\n\r\n    axisTitle\r\n        .text(function(d) { return d.label; })\r\n        .each(function(d) {\r\n            var e = d3.select(this);\r\n            Drawing.font(e, d.model.labelFont);\r\n            svgTextUtils.convertToTspans(e, gd);\r\n        })\r\n        .attr('transform', function(d) {\r\n            var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\r\n            var r = c.axisTitleOffset;\r\n            return (\r\n                (tilt.dir > 0 ? '' : strTranslate(0, 2 * r + d.model.height)) +\r\n                strRotate(tilt.degrees) +\r\n                strTranslate(-r * tilt.dx, -r * tilt.dy)\r\n            );\r\n        })\r\n        .attr('text-anchor', function(d) {\r\n            var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\r\n            var adx = Math.abs(tilt.dx);\r\n            var ady = Math.abs(tilt.dy);\r\n\r\n            if(2 * adx > ady) {\r\n                return (tilt.dir * tilt.dx < 0) ? 'start' : 'end';\r\n            } else {\r\n                return 'middle';\r\n            }\r\n        });\r\n\r\n    var axisExtent = axisOverlays.selectAll('.' + c.cn.axisExtent)\r\n        .data(repeat, keyFun);\r\n\r\n    axisExtent.enter()\r\n        .append('g')\r\n        .classed(c.cn.axisExtent, true);\r\n\r\n    var axisExtentTop = axisExtent.selectAll('.' + c.cn.axisExtentTop)\r\n        .data(repeat, keyFun);\r\n\r\n    axisExtentTop.enter()\r\n        .append('g')\r\n        .classed(c.cn.axisExtentTop, true);\r\n\r\n    axisExtentTop\r\n        .attr('transform', strTranslate(0, -c.axisExtentOffset));\r\n\r\n    var axisExtentTopText = axisExtentTop.selectAll('.' + c.cn.axisExtentTopText)\r\n        .data(repeat, keyFun);\r\n\r\n    axisExtentTopText.enter()\r\n        .append('text')\r\n        .classed(c.cn.axisExtentTopText, true)\r\n        .call(styleExtentTexts);\r\n\r\n    axisExtentTopText\r\n        .text(function(d) { return extremeText(d, true); })\r\n        .each(function(d) { Drawing.font(d3.select(this), d.model.rangeFont); });\r\n\r\n    var axisExtentBottom = axisExtent.selectAll('.' + c.cn.axisExtentBottom)\r\n        .data(repeat, keyFun);\r\n\r\n    axisExtentBottom.enter()\r\n        .append('g')\r\n        .classed(c.cn.axisExtentBottom, true);\r\n\r\n    axisExtentBottom\r\n        .attr('transform', function(d) {\r\n            return strTranslate(0, d.model.height + c.axisExtentOffset);\r\n        });\r\n\r\n    var axisExtentBottomText = axisExtentBottom.selectAll('.' + c.cn.axisExtentBottomText)\r\n        .data(repeat, keyFun);\r\n\r\n    axisExtentBottomText.enter()\r\n        .append('text')\r\n        .classed(c.cn.axisExtentBottomText, true)\r\n        .attr('dy', '0.75em')\r\n        .call(styleExtentTexts);\r\n\r\n    axisExtentBottomText\r\n        .text(function(d) { return extremeText(d, false); })\r\n        .each(function(d) { Drawing.font(d3.select(this), d.model.rangeFont); });\r\n\r\n    brush.ensureAxisBrush(axisOverlays, paperColor);\r\n};\r\n"]},"metadata":{},"sourceType":"script"}