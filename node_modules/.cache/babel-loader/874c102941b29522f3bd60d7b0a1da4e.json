{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar utcFormat = require('d3-time-format').utcFormat;\n\nvar isNumeric = require('fast-isnumeric');\n\nvar numConstants = require('../constants/numerical');\n\nvar MAX_SAFE = numConstants.FP_SAFE;\nvar MIN_SAFE = -MAX_SAFE;\nvar BADNUM = numConstants.BADNUM;\nvar lib = module.exports = {};\nlib.nestedProperty = require('./nested_property');\nlib.keyedContainer = require('./keyed_container');\nlib.relativeAttr = require('./relative_attr');\nlib.isPlainObject = require('./is_plain_object');\nlib.toLogRange = require('./to_log_range');\nlib.relinkPrivateKeys = require('./relink_private');\n\nvar arrayModule = require('./array');\n\nlib.isTypedArray = arrayModule.isTypedArray;\nlib.isArrayOrTypedArray = arrayModule.isArrayOrTypedArray;\nlib.isArray1D = arrayModule.isArray1D;\nlib.ensureArray = arrayModule.ensureArray;\nlib.concat = arrayModule.concat;\nlib.maxRowLength = arrayModule.maxRowLength;\nlib.minRowLength = arrayModule.minRowLength;\n\nvar modModule = require('./mod');\n\nlib.mod = modModule.mod;\nlib.modHalf = modModule.modHalf;\n\nvar coerceModule = require('./coerce');\n\nlib.valObjectMeta = coerceModule.valObjectMeta;\nlib.coerce = coerceModule.coerce;\nlib.coerce2 = coerceModule.coerce2;\nlib.coerceFont = coerceModule.coerceFont;\nlib.coercePattern = coerceModule.coercePattern;\nlib.coerceHoverinfo = coerceModule.coerceHoverinfo;\nlib.coerceSelectionMarkerOpacity = coerceModule.coerceSelectionMarkerOpacity;\nlib.validate = coerceModule.validate;\n\nvar datesModule = require('./dates');\n\nlib.dateTime2ms = datesModule.dateTime2ms;\nlib.isDateTime = datesModule.isDateTime;\nlib.ms2DateTime = datesModule.ms2DateTime;\nlib.ms2DateTimeLocal = datesModule.ms2DateTimeLocal;\nlib.cleanDate = datesModule.cleanDate;\nlib.isJSDate = datesModule.isJSDate;\nlib.formatDate = datesModule.formatDate;\nlib.incrementMonth = datesModule.incrementMonth;\nlib.dateTick0 = datesModule.dateTick0;\nlib.dfltRange = datesModule.dfltRange;\nlib.findExactDates = datesModule.findExactDates;\nlib.MIN_MS = datesModule.MIN_MS;\nlib.MAX_MS = datesModule.MAX_MS;\n\nvar searchModule = require('./search');\n\nlib.findBin = searchModule.findBin;\nlib.sorterAsc = searchModule.sorterAsc;\nlib.sorterDes = searchModule.sorterDes;\nlib.distinctVals = searchModule.distinctVals;\nlib.roundUp = searchModule.roundUp;\nlib.sort = searchModule.sort;\nlib.findIndexOfMin = searchModule.findIndexOfMin;\n\nvar statsModule = require('./stats');\n\nlib.aggNums = statsModule.aggNums;\nlib.len = statsModule.len;\nlib.mean = statsModule.mean;\nlib.median = statsModule.median;\nlib.midRange = statsModule.midRange;\nlib.variance = statsModule.variance;\nlib.stdev = statsModule.stdev;\nlib.interp = statsModule.interp;\n\nvar matrixModule = require('./matrix');\n\nlib.init2dArray = matrixModule.init2dArray;\nlib.transposeRagged = matrixModule.transposeRagged;\nlib.dot = matrixModule.dot;\nlib.translationMatrix = matrixModule.translationMatrix;\nlib.rotationMatrix = matrixModule.rotationMatrix;\nlib.rotationXYMatrix = matrixModule.rotationXYMatrix;\nlib.apply3DTransform = matrixModule.apply3DTransform;\nlib.apply2DTransform = matrixModule.apply2DTransform;\nlib.apply2DTransform2 = matrixModule.apply2DTransform2;\nlib.convertCssMatrix = matrixModule.convertCssMatrix;\nlib.inverseTransformMatrix = matrixModule.inverseTransformMatrix;\n\nvar anglesModule = require('./angles');\n\nlib.deg2rad = anglesModule.deg2rad;\nlib.rad2deg = anglesModule.rad2deg;\nlib.angleDelta = anglesModule.angleDelta;\nlib.angleDist = anglesModule.angleDist;\nlib.isFullCircle = anglesModule.isFullCircle;\nlib.isAngleInsideSector = anglesModule.isAngleInsideSector;\nlib.isPtInsideSector = anglesModule.isPtInsideSector;\nlib.pathArc = anglesModule.pathArc;\nlib.pathSector = anglesModule.pathSector;\nlib.pathAnnulus = anglesModule.pathAnnulus;\n\nvar anchorUtils = require('./anchor_utils');\n\nlib.isLeftAnchor = anchorUtils.isLeftAnchor;\nlib.isCenterAnchor = anchorUtils.isCenterAnchor;\nlib.isRightAnchor = anchorUtils.isRightAnchor;\nlib.isTopAnchor = anchorUtils.isTopAnchor;\nlib.isMiddleAnchor = anchorUtils.isMiddleAnchor;\nlib.isBottomAnchor = anchorUtils.isBottomAnchor;\n\nvar geom2dModule = require('./geometry2d');\n\nlib.segmentsIntersect = geom2dModule.segmentsIntersect;\nlib.segmentDistance = geom2dModule.segmentDistance;\nlib.getTextLocation = geom2dModule.getTextLocation;\nlib.clearLocationCache = geom2dModule.clearLocationCache;\nlib.getVisibleSegment = geom2dModule.getVisibleSegment;\nlib.findPointOnPath = geom2dModule.findPointOnPath;\n\nvar extendModule = require('./extend');\n\nlib.extendFlat = extendModule.extendFlat;\nlib.extendDeep = extendModule.extendDeep;\nlib.extendDeepAll = extendModule.extendDeepAll;\nlib.extendDeepNoArrays = extendModule.extendDeepNoArrays;\n\nvar loggersModule = require('./loggers');\n\nlib.log = loggersModule.log;\nlib.warn = loggersModule.warn;\nlib.error = loggersModule.error;\n\nvar regexModule = require('./regex');\n\nlib.counterRegex = regexModule.counter;\n\nvar throttleModule = require('./throttle');\n\nlib.throttle = throttleModule.throttle;\nlib.throttleDone = throttleModule.done;\nlib.clearThrottle = throttleModule.clear;\n\nvar domModule = require('./dom');\n\nlib.getGraphDiv = domModule.getGraphDiv;\nlib.isPlotDiv = domModule.isPlotDiv;\nlib.removeElement = domModule.removeElement;\nlib.addStyleRule = domModule.addStyleRule;\nlib.addRelatedStyleRule = domModule.addRelatedStyleRule;\nlib.deleteRelatedStyleRule = domModule.deleteRelatedStyleRule;\nlib.getFullTransformMatrix = domModule.getFullTransformMatrix;\nlib.getElementTransformMatrix = domModule.getElementTransformMatrix;\nlib.getElementAndAncestors = domModule.getElementAndAncestors;\nlib.equalDomRects = domModule.equalDomRects;\nlib.clearResponsive = require('./clear_responsive');\nlib.preserveDrawingBuffer = require('./preserve_drawing_buffer');\nlib.makeTraceGroups = require('./make_trace_groups');\nlib._ = require('./localize');\nlib.notifier = require('./notifier');\nlib.filterUnique = require('./filter_unique');\nlib.filterVisible = require('./filter_visible');\nlib.pushUnique = require('./push_unique');\nlib.increment = require('./increment');\nlib.cleanNumber = require('./clean_number');\n\nlib.ensureNumber = function ensureNumber(v) {\n  if (!isNumeric(v)) return BADNUM;\n  v = Number(v);\n  return v > MAX_SAFE || v < MIN_SAFE ? BADNUM : v;\n};\n/**\r\n * Is v a valid array index? Accepts numeric strings as well as numbers.\r\n *\r\n * @param {any} v: the value to test\r\n * @param {Optional[integer]} len: the array length we are indexing\r\n *\r\n * @return {bool}: v is a valid array index\r\n */\n\n\nlib.isIndex = function (v, len) {\n  if (len !== undefined && v >= len) return false;\n  return isNumeric(v) && v >= 0 && v % 1 === 0;\n};\n\nlib.noop = require('./noop');\nlib.identity = require('./identity');\n/**\r\n * create an array of length 'cnt' filled with 'v' at all indices\r\n *\r\n * @param {any} v\r\n * @param {number} cnt\r\n * @return {array}\r\n */\n\nlib.repeat = function (v, cnt) {\n  var out = new Array(cnt);\n\n  for (var i = 0; i < cnt; i++) {\n    out[i] = v;\n  }\n\n  return out;\n};\n/**\r\n * swap x and y of the same attribute in container cont\r\n * specify attr with a ? in place of x/y\r\n * you can also swap other things than x/y by providing part1 and part2\r\n */\n\n\nlib.swapAttrs = function (cont, attrList, part1, part2) {\n  if (!part1) part1 = 'x';\n  if (!part2) part2 = 'y';\n\n  for (var i = 0; i < attrList.length; i++) {\n    var attr = attrList[i];\n    var xp = lib.nestedProperty(cont, attr.replace('?', part1));\n    var yp = lib.nestedProperty(cont, attr.replace('?', part2));\n    var temp = xp.get();\n    xp.set(yp.get());\n    yp.set(temp);\n  }\n};\n/**\r\n * SVG painter's algo worked around with reinsertion\r\n */\n\n\nlib.raiseToTop = function raiseToTop(elem) {\n  elem.parentNode.appendChild(elem);\n};\n/**\r\n * cancel a possibly pending transition; returned selection may be used by caller\r\n */\n\n\nlib.cancelTransition = function (selection) {\n  return selection.transition().duration(0);\n}; // constrain - restrict a number v to be between v0 and v1\n\n\nlib.constrain = function (v, v0, v1) {\n  if (v0 > v1) return Math.max(v1, Math.min(v0, v));\n  return Math.max(v0, Math.min(v1, v));\n};\n/**\r\n * do two bounding boxes from getBoundingClientRect,\r\n * ie {left,right,top,bottom,width,height}, overlap?\r\n * takes optional padding pixels\r\n */\n\n\nlib.bBoxIntersect = function (a, b, pad) {\n  pad = pad || 0;\n  return a.left <= b.right + pad && b.left <= a.right + pad && a.top <= b.bottom + pad && b.top <= a.bottom + pad;\n};\n/*\r\n * simpleMap: alternative to Array.map that only\r\n * passes on the element and up to 2 extra args you\r\n * provide (but not the array index or the whole array)\r\n *\r\n * array: the array to map it to\r\n * func: the function to apply\r\n * x1, x2: optional extra args\r\n */\n\n\nlib.simpleMap = function (array, func, x1, x2, opts) {\n  var len = array.length;\n  var out = new Array(len);\n\n  for (var i = 0; i < len; i++) out[i] = func(array[i], x1, x2, opts);\n\n  return out;\n};\n/**\r\n * Random string generator\r\n *\r\n * @param {object} existing\r\n *     pass in strings to avoid as keys with truthy values\r\n * @param {int} bits\r\n *     bits of information in the output string, default 24\r\n * @param {int} base\r\n *     base of string representation, default 16. Should be a power of 2.\r\n */\n\n\nlib.randstr = function randstr(existing, bits, base, _recursion) {\n  if (!base) base = 16;\n  if (bits === undefined) bits = 24;\n  if (bits <= 0) return '0';\n  var digits = Math.log(Math.pow(2, bits)) / Math.log(base);\n  var res = '';\n  var i, b, x;\n\n  for (i = 2; digits === Infinity; i *= 2) {\n    digits = Math.log(Math.pow(2, bits / i)) / Math.log(base) * i;\n  }\n\n  var rem = digits - Math.floor(digits);\n\n  for (i = 0; i < Math.floor(digits); i++) {\n    x = Math.floor(Math.random() * base).toString(base);\n    res = x + res;\n  }\n\n  if (rem) {\n    b = Math.pow(base, rem);\n    x = Math.floor(Math.random() * b).toString(base);\n    res = x + res;\n  }\n\n  var parsed = parseInt(res, base);\n\n  if (existing && existing[res] || parsed !== Infinity && parsed >= Math.pow(2, bits)) {\n    if (_recursion > 10) {\n      lib.warn('randstr failed uniqueness');\n      return res;\n    }\n\n    return randstr(existing, bits, base, (_recursion || 0) + 1);\n  } else return res;\n};\n\nlib.OptionControl = function (opt, optname) {\n  /*\r\n   * An environment to contain all option setters and\r\n   * getters that collectively modify opts.\r\n   *\r\n   * You can call up opts from any function in new object\r\n   * as this.optname || this.opt\r\n   *\r\n   * See FitOpts for example of usage\r\n   */\n  if (!opt) opt = {};\n  if (!optname) optname = 'opt';\n  var self = {};\n  self.optionList = [];\n\n  self._newoption = function (optObj) {\n    optObj[optname] = opt;\n    self[optObj.name] = optObj;\n    self.optionList.push(optObj);\n  };\n\n  self['_' + optname] = opt;\n  return self;\n};\n/**\r\n * lib.smooth: smooth arrayIn by convolving with\r\n * a hann window with given full width at half max\r\n * bounce the ends in, so the output has the same length as the input\r\n */\n\n\nlib.smooth = function (arrayIn, FWHM) {\n  FWHM = Math.round(FWHM) || 0; // only makes sense for integers\n\n  if (FWHM < 2) return arrayIn;\n  var alen = arrayIn.length;\n  var alen2 = 2 * alen;\n  var wlen = 2 * FWHM - 1;\n  var w = new Array(wlen);\n  var arrayOut = new Array(alen);\n  var i;\n  var j;\n  var k;\n  var v; // first make the window array\n\n  for (i = 0; i < wlen; i++) {\n    w[i] = (1 - Math.cos(Math.PI * (i + 1) / FWHM)) / (2 * FWHM);\n  } // now do the convolution\n\n\n  for (i = 0; i < alen; i++) {\n    v = 0;\n\n    for (j = 0; j < wlen; j++) {\n      k = i + j + 1 - FWHM; // multibounce\n\n      if (k < -alen) k -= alen2 * Math.round(k / alen2);else if (k >= alen2) k -= alen2 * Math.floor(k / alen2); // single bounce\n\n      if (k < 0) k = -1 - k;else if (k >= alen) k = alen2 - 1 - k;\n      v += arrayIn[k] * w[j];\n    }\n\n    arrayOut[i] = v;\n  }\n\n  return arrayOut;\n};\n/**\r\n * syncOrAsync: run a sequence of functions synchronously\r\n * as long as its returns are not promises (ie have no .then)\r\n * includes one argument arg to send to all functions...\r\n * this is mainly just to prevent us having to make wrapper functions\r\n * when the only purpose of the wrapper is to reference gd\r\n * and a final step to be executed at the end\r\n * TODO: if there's an error and everything is sync,\r\n * this doesn't happen yet because we want to make sure\r\n * that it gets reported\r\n */\n\n\nlib.syncOrAsync = function (sequence, arg, finalStep) {\n  var ret, fni;\n\n  function continueAsync() {\n    return lib.syncOrAsync(sequence, arg, finalStep);\n  }\n\n  while (sequence.length) {\n    fni = sequence.splice(0, 1)[0];\n    ret = fni(arg);\n\n    if (ret && ret.then) {\n      return ret.then(continueAsync).then(undefined, lib.promiseError);\n    }\n  }\n\n  return finalStep && finalStep(arg);\n};\n/**\r\n * Helper to strip trailing slash, from\r\n * http://stackoverflow.com/questions/6680825/return-string-without-trailing-slash\r\n */\n\n\nlib.stripTrailingSlash = function (str) {\n  if (str.substr(-1) === '/') return str.substr(0, str.length - 1);\n  return str;\n};\n\nlib.noneOrAll = function (containerIn, containerOut, attrList) {\n  /**\r\n   * some attributes come together, so if you have one of them\r\n   * in the input, you should copy the default values of the others\r\n   * to the input as well.\r\n   */\n  if (!containerIn) return;\n  var hasAny = false;\n  var hasAll = true;\n  var i;\n  var val;\n\n  for (i = 0; i < attrList.length; i++) {\n    val = containerIn[attrList[i]];\n    if (val !== undefined && val !== null) hasAny = true;else hasAll = false;\n  }\n\n  if (hasAny && !hasAll) {\n    for (i = 0; i < attrList.length; i++) {\n      containerIn[attrList[i]] = containerOut[attrList[i]];\n    }\n  }\n};\n/** merges calcdata field (given by cdAttr) with traceAttr values\r\n *\r\n * N.B. Loop over minimum of cd.length and traceAttr.length\r\n * i.e. it does not try to fill in beyond traceAttr.length-1\r\n *\r\n * @param {array} traceAttr : trace attribute\r\n * @param {object} cd : calcdata trace\r\n * @param {string} cdAttr : calcdata key\r\n */\n\n\nlib.mergeArray = function (traceAttr, cd, cdAttr, fn) {\n  var hasFn = typeof fn === 'function';\n\n  if (lib.isArrayOrTypedArray(traceAttr)) {\n    var imax = Math.min(traceAttr.length, cd.length);\n\n    for (var i = 0; i < imax; i++) {\n      var v = traceAttr[i];\n      cd[i][cdAttr] = hasFn ? fn(v) : v;\n    }\n  }\n}; // cast numbers to positive numbers, returns 0 if not greater than 0\n\n\nlib.mergeArrayCastPositive = function (traceAttr, cd, cdAttr) {\n  return lib.mergeArray(traceAttr, cd, cdAttr, function (v) {\n    var w = +v;\n    return !isFinite(w) ? 0 : w > 0 ? w : 0;\n  });\n};\n/** fills calcdata field (given by cdAttr) with traceAttr values\r\n *  or function of traceAttr values (e.g. some fallback)\r\n *\r\n * N.B. Loops over all cd items.\r\n *\r\n * @param {array} traceAttr : trace attribute\r\n * @param {object} cd : calcdata trace\r\n * @param {string} cdAttr : calcdata key\r\n * @param {function} [fn] : optional function to apply to each array item\r\n */\n\n\nlib.fillArray = function (traceAttr, cd, cdAttr, fn) {\n  fn = fn || lib.identity;\n\n  if (lib.isArrayOrTypedArray(traceAttr)) {\n    for (var i = 0; i < cd.length; i++) {\n      cd[i][cdAttr] = fn(traceAttr[i]);\n    }\n  }\n};\n/** Handler for trace-wide vs per-point options\r\n *\r\n * @param {object} trace : (full) trace object\r\n * @param {number} ptNumber : index of the point in question\r\n * @param {string} astr : attribute string\r\n * @param {function} [fn] : optional function to apply to each array item\r\n *\r\n * @return {any}\r\n */\n\n\nlib.castOption = function (trace, ptNumber, astr, fn) {\n  fn = fn || lib.identity;\n  var val = lib.nestedProperty(trace, astr).get();\n\n  if (lib.isArrayOrTypedArray(val)) {\n    if (Array.isArray(ptNumber) && lib.isArrayOrTypedArray(val[ptNumber[0]])) {\n      return fn(val[ptNumber[0]][ptNumber[1]]);\n    } else {\n      return fn(val[ptNumber]);\n    }\n  } else {\n    return val;\n  }\n};\n/** Extract option from calcdata item, correctly falling back to\r\n *  trace value if not found.\r\n *\r\n *  @param {object} calcPt : calcdata[i][j] item\r\n *  @param {object} trace : (full) trace object\r\n *  @param {string} calcKey : calcdata key\r\n *  @param {string} traceKey : aka trace attribute string\r\n *  @return {any}\r\n */\n\n\nlib.extractOption = function (calcPt, trace, calcKey, traceKey) {\n  if (calcKey in calcPt) return calcPt[calcKey]; // fallback to trace value,\n  //   must check if value isn't itself an array\n  //   which means the trace attribute has a corresponding\n  //   calcdata key, but its value is falsy\n\n  var traceVal = lib.nestedProperty(trace, traceKey).get();\n  if (!Array.isArray(traceVal)) return traceVal;\n};\n\nfunction makePtIndex2PtNumber(indexToPoints) {\n  var ptIndex2ptNumber = {};\n\n  for (var k in indexToPoints) {\n    var pts = indexToPoints[k];\n\n    for (var j = 0; j < pts.length; j++) {\n      ptIndex2ptNumber[pts[j]] = +k;\n    }\n  }\n\n  return ptIndex2ptNumber;\n}\n/** Tag selected calcdata items\r\n *\r\n * N.B. note that point 'index' corresponds to input data array index\r\n *  whereas 'number' is its post-transform version.\r\n *\r\n * @param {array} calcTrace\r\n * @param {object} trace\r\n *  - selectedpoints {array}\r\n *  - _indexToPoints {object}\r\n * @param {ptNumber2cdIndex} ptNumber2cdIndex (optional)\r\n *  optional map object for trace types that do not have 1-to-1 point number to\r\n *  calcdata item index correspondence (e.g. histogram)\r\n */\n\n\nlib.tagSelected = function (calcTrace, trace, ptNumber2cdIndex) {\n  var selectedpoints = trace.selectedpoints;\n  var indexToPoints = trace._indexToPoints;\n  var ptIndex2ptNumber; // make pt index-to-number map object, which takes care of transformed traces\n\n  if (indexToPoints) {\n    ptIndex2ptNumber = makePtIndex2PtNumber(indexToPoints);\n  }\n\n  function isCdIndexValid(v) {\n    return v !== undefined && v < calcTrace.length;\n  }\n\n  for (var i = 0; i < selectedpoints.length; i++) {\n    var ptIndex = selectedpoints[i];\n\n    if (lib.isIndex(ptIndex) || lib.isArrayOrTypedArray(ptIndex) && lib.isIndex(ptIndex[0]) && lib.isIndex(ptIndex[1])) {\n      var ptNumber = ptIndex2ptNumber ? ptIndex2ptNumber[ptIndex] : ptIndex;\n      var cdIndex = ptNumber2cdIndex ? ptNumber2cdIndex[ptNumber] : ptNumber;\n\n      if (isCdIndexValid(cdIndex)) {\n        calcTrace[cdIndex].selected = 1;\n      }\n    }\n  }\n};\n\nlib.selIndices2selPoints = function (trace) {\n  var selectedpoints = trace.selectedpoints;\n  var indexToPoints = trace._indexToPoints;\n\n  if (indexToPoints) {\n    var ptIndex2ptNumber = makePtIndex2PtNumber(indexToPoints);\n    var out = [];\n\n    for (var i = 0; i < selectedpoints.length; i++) {\n      var ptIndex = selectedpoints[i];\n\n      if (lib.isIndex(ptIndex)) {\n        var ptNumber = ptIndex2ptNumber[ptIndex];\n\n        if (lib.isIndex(ptNumber)) {\n          out.push(ptNumber);\n        }\n      }\n    }\n\n    return out;\n  } else {\n    return selectedpoints;\n  }\n};\n/** Returns target as set by 'target' transform attribute\r\n *\r\n * @param {object} trace : full trace object\r\n * @param {object} transformOpts : transform option object\r\n *  - target (string} :\r\n *      either an attribute string referencing an array in the trace object, or\r\n *      a set array.\r\n *\r\n * @return {array or false} : the target array (NOT a copy!!) or false if invalid\r\n */\n\n\nlib.getTargetArray = function (trace, transformOpts) {\n  var target = transformOpts.target;\n\n  if (typeof target === 'string' && target) {\n    var array = lib.nestedProperty(trace, target).get();\n    return Array.isArray(array) ? array : false;\n  } else if (Array.isArray(target)) {\n    return target;\n  }\n\n  return false;\n};\n/**\r\n * modified version of jQuery's extend to strip out private objs and functions,\r\n * and cut arrays down to first <arraylen> or 1 elements\r\n * because extend-like algorithms are hella slow\r\n * obj2 is assumed to already be clean of these things (including no arrays)\r\n */\n\n\nlib.minExtend = function (obj1, obj2) {\n  var objOut = {};\n  if (typeof obj2 !== 'object') obj2 = {};\n  var arrayLen = 3;\n  var keys = Object.keys(obj1);\n  var i, k, v;\n\n  for (i = 0; i < keys.length; i++) {\n    k = keys[i];\n    v = obj1[k];\n    if (k.charAt(0) === '_' || typeof v === 'function') continue;else if (k === 'module') objOut[k] = v;else if (Array.isArray(v)) {\n      if (k === 'colorscale') {\n        objOut[k] = v.slice();\n      } else {\n        objOut[k] = v.slice(0, arrayLen);\n      }\n    } else if (lib.isTypedArray(v)) {\n      objOut[k] = v.subarray(0, arrayLen);\n    } else if (v && typeof v === 'object') objOut[k] = lib.minExtend(obj1[k], obj2[k]);else objOut[k] = v;\n  }\n\n  keys = Object.keys(obj2);\n\n  for (i = 0; i < keys.length; i++) {\n    k = keys[i];\n    v = obj2[k];\n\n    if (typeof v !== 'object' || !(k in objOut) || typeof objOut[k] !== 'object') {\n      objOut[k] = v;\n    }\n  }\n\n  return objOut;\n};\n\nlib.titleCase = function (s) {\n  return s.charAt(0).toUpperCase() + s.substr(1);\n};\n\nlib.containsAny = function (s, fragments) {\n  for (var i = 0; i < fragments.length; i++) {\n    if (s.indexOf(fragments[i]) !== -1) return true;\n  }\n\n  return false;\n};\n\nlib.isIE = function () {\n  return typeof window.navigator.msSaveBlob !== 'undefined';\n};\n\nvar IS_SAFARI_REGEX = /Version\\/[\\d\\.]+.*Safari/;\n\nlib.isSafari = function () {\n  return IS_SAFARI_REGEX.test(window.navigator.userAgent);\n};\n\nvar IS_IOS_REGEX = /iPad|iPhone|iPod/;\n\nlib.isIOS = function () {\n  return IS_IOS_REGEX.test(window.navigator.userAgent);\n};\n\nvar FIREFOX_VERSION_REGEX = /Firefox\\/(\\d+)\\.\\d+/;\n\nlib.getFirefoxVersion = function () {\n  var match = FIREFOX_VERSION_REGEX.exec(window.navigator.userAgent);\n\n  if (match && match.length === 2) {\n    var versionInt = parseInt(match[1]);\n\n    if (!isNaN(versionInt)) {\n      return versionInt;\n    }\n  }\n\n  return null;\n};\n\nlib.isD3Selection = function (obj) {\n  return obj instanceof d3.selection;\n};\n/**\r\n * Append element to DOM only if not present.\r\n *\r\n * @param {d3 selection} parent : parent selection of the element in question\r\n * @param {string} nodeType : node type of element to append\r\n * @param {string} className (optional) : class name of element in question\r\n * @param {fn} enterFn (optional) : optional fn applied to entering elements only\r\n * @return {d3 selection} selection of new layer\r\n *\r\n * Previously, we were using the following pattern:\r\n *\r\n * ```\r\n * var sel = parent.selectAll('.' + className)\r\n *     .data([0]);\r\n *\r\n * sel.enter().append(nodeType)\r\n *     .classed(className, true);\r\n *\r\n * return sel;\r\n * ```\r\n *\r\n * in numerous places in our codebase to achieve the same behavior.\r\n *\r\n * The logic below performs much better, mostly as we are using\r\n * `.select` instead `.selectAll` that is `querySelector` instead of\r\n * `querySelectorAll`.\r\n *\r\n */\n\n\nlib.ensureSingle = function (parent, nodeType, className, enterFn) {\n  var sel = parent.select(nodeType + (className ? '.' + className : ''));\n  if (sel.size()) return sel;\n  var layer = parent.append(nodeType);\n  if (className) layer.classed(className, true);\n  if (enterFn) layer.call(enterFn);\n  return layer;\n};\n/**\r\n * Same as Lib.ensureSingle, but using id as selector.\r\n * This version is mostly used for clipPath nodes.\r\n *\r\n * @param {d3 selection} parent : parent selection of the element in question\r\n * @param {string} nodeType : node type of element to append\r\n * @param {string} id : id of element in question\r\n * @param {fn} enterFn (optional) : optional fn applied to entering elements only\r\n * @return {d3 selection} selection of new layer\r\n */\n\n\nlib.ensureSingleById = function (parent, nodeType, id, enterFn) {\n  var sel = parent.select(nodeType + '#' + id);\n  if (sel.size()) return sel;\n  var layer = parent.append(nodeType).attr('id', id);\n  if (enterFn) layer.call(enterFn);\n  return layer;\n};\n/**\r\n * Converts a string path to an object.\r\n *\r\n * When given a string containing an array element, it will create a `null`\r\n * filled array of the given size.\r\n *\r\n * @example\r\n * lib.objectFromPath('nested.test[2].path', 'value');\r\n * // returns { nested: { test: [null, null, { path: 'value' }]}\r\n *\r\n * @param   {string}    path to nested value\r\n * @param   {*}         any value to be set\r\n *\r\n * @return {Object} the constructed object with a full nested path\r\n */\n\n\nlib.objectFromPath = function (path, value) {\n  var keys = path.split('.');\n  var tmpObj;\n  var obj = tmpObj = {};\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var el = null;\n    var parts = keys[i].match(/(.*)\\[([0-9]+)\\]/);\n\n    if (parts) {\n      key = parts[1];\n      el = parts[2];\n      tmpObj = tmpObj[key] = [];\n\n      if (i === keys.length - 1) {\n        tmpObj[el] = value;\n      } else {\n        tmpObj[el] = {};\n      }\n\n      tmpObj = tmpObj[el];\n    } else {\n      if (i === keys.length - 1) {\n        tmpObj[key] = value;\n      } else {\n        tmpObj[key] = {};\n      }\n\n      tmpObj = tmpObj[key];\n    }\n  }\n\n  return obj;\n};\n/**\r\n * Iterate through an object in-place, converting dotted properties to objects.\r\n *\r\n * Examples:\r\n *\r\n *   lib.expandObjectPaths({'nested.test.path': 'value'});\r\n *     => { nested: { test: {path: 'value'}}}\r\n *\r\n * It also handles array notation, e.g.:\r\n *\r\n *   lib.expandObjectPaths({'foo[1].bar': 'value'});\r\n *     => { foo: [null, {bar: value}] }\r\n *\r\n * It handles merges the results when two properties are specified in parallel:\r\n *\r\n *   lib.expandObjectPaths({'foo[1].bar': 10, 'foo[0].bar': 20});\r\n *     => { foo: [{bar: 10}, {bar: 20}] }\r\n *\r\n * It does NOT, however, merge multiple multiply-nested arrays::\r\n *\r\n *   lib.expandObjectPaths({'marker[1].range[1]': 5, 'marker[1].range[0]': 4})\r\n *     => { marker: [null, {range: 4}] }\r\n */\n// Store this to avoid recompiling regex on *every* prop since this may happen many\n// many times for animations. Could maybe be inside the function. Not sure about\n// scoping vs. recompilation tradeoff, but at least it's not just inlining it into\n// the inner loop.\n\n\nvar dottedPropertyRegex = /^([^\\[\\.]+)\\.(.+)?/;\nvar indexedPropertyRegex = /^([^\\.]+)\\[([0-9]+)\\](\\.)?(.+)?/;\n\nlib.expandObjectPaths = function (data) {\n  var match, key, prop, datum, idx, dest, trailingPath;\n\n  if (typeof data === 'object' && !Array.isArray(data)) {\n    for (key in data) {\n      if (data.hasOwnProperty(key)) {\n        if (match = key.match(dottedPropertyRegex)) {\n          datum = data[key];\n          prop = match[1];\n          delete data[key];\n          data[prop] = lib.extendDeepNoArrays(data[prop] || {}, lib.objectFromPath(key, lib.expandObjectPaths(datum))[prop]);\n        } else if (match = key.match(indexedPropertyRegex)) {\n          datum = data[key];\n          prop = match[1];\n          idx = parseInt(match[2]);\n          delete data[key];\n          data[prop] = data[prop] || [];\n\n          if (match[3] === '.') {\n            // This is the case where theere are subsequent properties into which\n            // we must recurse, e.g. transforms[0].value\n            trailingPath = match[4];\n            dest = data[prop][idx] = data[prop][idx] || {}; // NB: Extend deep no arrays prevents this from working on multiple\n            // nested properties in the same object, e.g.\n            //\n            // {\n            //   foo[0].bar[1].range\n            //   foo[0].bar[0].range\n            // }\n            //\n            // In this case, the extendDeepNoArrays will overwrite one array with\n            // the other, so that both properties *will not* be present in the\n            // result. Fixing this would require a more intelligent tracking\n            // of changes and merging than extendDeepNoArrays currently accomplishes.\n\n            lib.extendDeepNoArrays(dest, lib.objectFromPath(trailingPath, lib.expandObjectPaths(datum)));\n          } else {\n            // This is the case where this property is the end of the line,\n            // e.g. xaxis.range[0]\n            data[prop][idx] = lib.expandObjectPaths(datum);\n          }\n        } else {\n          data[key] = lib.expandObjectPaths(data[key]);\n        }\n      }\n    }\n  }\n\n  return data;\n};\n/**\r\n * Converts value to string separated by the provided separators.\r\n *\r\n * @example\r\n * lib.numSeparate(2016, '.,');\r\n * // returns '2016'\r\n *\r\n * @example\r\n * lib.numSeparate(3000, '.,', true);\r\n * // returns '3,000'\r\n *\r\n * @example\r\n * lib.numSeparate(1234.56, '|,')\r\n * // returns '1,234|56'\r\n *\r\n * @param   {string|number} value       the value to be converted\r\n * @param   {string}    separators  string of decimal, then thousands separators\r\n * @param   {boolean}    separatethousands  boolean, 4-digit integers are separated if true\r\n *\r\n * @return  {string}    the value that has been separated\r\n */\n\n\nlib.numSeparate = function (value, separators, separatethousands) {\n  if (!separatethousands) separatethousands = false;\n\n  if (typeof separators !== 'string' || separators.length === 0) {\n    throw new Error('Separator string required for formatting!');\n  }\n\n  if (typeof value === 'number') {\n    value = String(value);\n  }\n\n  var thousandsRe = /(\\d+)(\\d{3})/;\n  var decimalSep = separators.charAt(0);\n  var thouSep = separators.charAt(1);\n  var x = value.split('.');\n  var x1 = x[0];\n  var x2 = x.length > 1 ? decimalSep + x[1] : ''; // Years are ignored for thousands separators\n\n  if (thouSep && (x.length > 1 || x1.length > 4 || separatethousands)) {\n    while (thousandsRe.test(x1)) {\n      x1 = x1.replace(thousandsRe, '$1' + thouSep + '$2');\n    }\n  }\n\n  return x1 + x2;\n};\n\nlib.TEMPLATE_STRING_REGEX = /%{([^\\s%{}:]*)([:|\\|][^}]*)?}/g;\nvar SIMPLE_PROPERTY_REGEX = /^\\w*$/;\n/**\r\n * Substitute values from an object into a string\r\n *\r\n * Examples:\r\n *  Lib.templateString('name: %{trace}', {trace: 'asdf'}) --> 'name: asdf'\r\n *  Lib.templateString('name: %{trace[0].name}', {trace: [{name: 'asdf'}]}) --> 'name: asdf'\r\n *\r\n * @param {string}  input string containing %{...} template strings\r\n * @param {obj}     data object containing substitution values\r\n *\r\n * @return {string} templated string\r\n */\n\nlib.templateString = function (string, obj) {\n  // Not all that useful, but cache nestedProperty instantiation\n  // just in case it speeds things up *slightly*:\n  var getterCache = {};\n  return string.replace(lib.TEMPLATE_STRING_REGEX, function (dummy, key) {\n    var v;\n\n    if (SIMPLE_PROPERTY_REGEX.test(key)) {\n      v = obj[key];\n    } else {\n      getterCache[key] = getterCache[key] || lib.nestedProperty(obj, key).get;\n      v = getterCache[key]();\n    }\n\n    return lib.isValidTextValue(v) ? v : '';\n  });\n};\n\nvar hovertemplateWarnings = {\n  max: 10,\n  count: 0,\n  name: 'hovertemplate'\n};\n\nlib.hovertemplateString = function () {\n  return templateFormatString.apply(hovertemplateWarnings, arguments);\n};\n\nvar texttemplateWarnings = {\n  max: 10,\n  count: 0,\n  name: 'texttemplate'\n};\n\nlib.texttemplateString = function () {\n  return templateFormatString.apply(texttemplateWarnings, arguments);\n};\n\nvar TEMPLATE_STRING_FORMAT_SEPARATOR = /^[:|\\|]/;\n/**\r\n * Substitute values from an object into a string and optionally formats them using d3-format,\r\n * or fallback to associated labels.\r\n *\r\n * Examples:\r\n *  Lib.hovertemplateString('name: %{trace}', {trace: 'asdf'}) --> 'name: asdf'\r\n *  Lib.hovertemplateString('name: %{trace[0].name}', {trace: [{name: 'asdf'}]}) --> 'name: asdf'\r\n *  Lib.hovertemplateString('price: %{y:$.2f}', {y: 1}) --> 'price: $1.00'\r\n *\r\n * @param {string}  input string containing %{...:...} template strings\r\n * @param {obj}     data object containing fallback text when no formatting is specified, ex.: {yLabel: 'formattedYValue'}\r\n * @param {obj}     d3 locale\r\n * @param {obj}     data objects containing substitution values\r\n *\r\n * @return {string} templated string\r\n */\n\nfunction templateFormatString(string, labels, d3locale) {\n  var opts = this;\n  var args = arguments;\n  if (!labels) labels = {}; // Not all that useful, but cache nestedProperty instantiation\n  // just in case it speeds things up *slightly*:\n\n  var getterCache = {};\n  return string.replace(lib.TEMPLATE_STRING_REGEX, function (match, rawKey, format) {\n    var isOther = rawKey === 'xother' || rawKey === 'yother';\n    var isSpaceOther = rawKey === '_xother' || rawKey === '_yother';\n    var isSpaceOtherSpace = rawKey === '_xother_' || rawKey === '_yother_';\n    var isOtherSpace = rawKey === 'xother_' || rawKey === 'yother_';\n    var hasOther = isOther || isSpaceOther || isOtherSpace || isSpaceOtherSpace;\n    var key = rawKey;\n    if (isSpaceOther || isSpaceOtherSpace) key = key.substring(1);\n    if (isOtherSpace || isSpaceOtherSpace) key = key.substring(0, key.length - 1);\n    var value;\n\n    if (hasOther) {\n      value = labels[key];\n      if (value === undefined) return '';\n    } else {\n      var obj, i;\n\n      for (i = 3; i < args.length; i++) {\n        obj = args[i];\n        if (!obj) continue;\n\n        if (obj.hasOwnProperty(key)) {\n          value = obj[key];\n          break;\n        }\n\n        if (!SIMPLE_PROPERTY_REGEX.test(key)) {\n          value = lib.nestedProperty(obj, key).get();\n          value = getterCache[key] || lib.nestedProperty(obj, key).get();\n          if (value) getterCache[key] = value;\n        }\n\n        if (value !== undefined) break;\n      }\n    }\n\n    if (value === undefined && opts) {\n      if (opts.count < opts.max) {\n        lib.warn('Variable \\'' + key + '\\' in ' + opts.name + ' could not be found!');\n        value = match;\n      }\n\n      if (opts.count === opts.max) {\n        lib.warn('Too many ' + opts.name + ' warnings - additional warnings will be suppressed');\n      }\n\n      opts.count++;\n      return match;\n    }\n\n    if (format) {\n      var fmt;\n\n      if (format[0] === ':') {\n        fmt = d3locale ? d3locale.numberFormat : d3.format;\n        value = fmt(format.replace(TEMPLATE_STRING_FORMAT_SEPARATOR, ''))(value);\n      }\n\n      if (format[0] === '|') {\n        fmt = d3locale ? d3locale.timeFormat : utcFormat;\n        var ms = lib.dateTime2ms(value);\n        value = lib.formatDate(ms, format.replace(TEMPLATE_STRING_FORMAT_SEPARATOR, ''), false, fmt);\n      }\n    } else {\n      var keyLabel = key + 'Label';\n      if (labels.hasOwnProperty(keyLabel)) value = labels[keyLabel];\n    }\n\n    if (hasOther) {\n      value = '(' + value + ')';\n      if (isSpaceOther || isSpaceOtherSpace) value = ' ' + value;\n      if (isOtherSpace || isSpaceOtherSpace) value = value + ' ';\n    }\n\n    return value;\n  });\n}\n/*\r\n * alphanumeric string sort, tailored for subplot IDs like scene2, scene10, x10y13 etc\r\n */\n\n\nvar char0 = 48;\nvar char9 = 57;\n\nlib.subplotSort = function (a, b) {\n  var l = Math.min(a.length, b.length) + 1;\n  var numA = 0;\n  var numB = 0;\n\n  for (var i = 0; i < l; i++) {\n    var charA = a.charCodeAt(i) || 0;\n    var charB = b.charCodeAt(i) || 0;\n    var isNumA = charA >= char0 && charA <= char9;\n    var isNumB = charB >= char0 && charB <= char9;\n    if (isNumA) numA = 10 * numA + charA - char0;\n    if (isNumB) numB = 10 * numB + charB - char0;\n\n    if (!isNumA || !isNumB) {\n      if (numA !== numB) return numA - numB;\n      if (charA !== charB) return charA - charB;\n    }\n  }\n\n  return numB - numA;\n}; // repeatable pseudorandom generator\n\n\nvar randSeed = 2000000000;\n\nlib.seedPseudoRandom = function () {\n  randSeed = 2000000000;\n};\n\nlib.pseudoRandom = function () {\n  var lastVal = randSeed;\n  randSeed = (69069 * randSeed + 1) % 4294967296; // don't let consecutive vals be too close together\n  // gets away from really trying to be random, in favor of better local uniformity\n\n  if (Math.abs(randSeed - lastVal) < 429496729) return lib.pseudoRandom();\n  return randSeed / 4294967296;\n};\n/** Fill hover 'pointData' container with 'correct' hover text value\r\n *\r\n * - If trace hoverinfo contains a 'text' flag and hovertext is not set,\r\n *   the text elements will be seen in the hover labels.\r\n *\r\n * - If trace hoverinfo contains a 'text' flag and hovertext is set,\r\n *   hovertext takes precedence over text\r\n *   i.e. the hoverinfo elements will be seen in the hover labels\r\n *\r\n *  @param {object} calcPt\r\n *  @param {object} trace\r\n *  @param {object || array} contOut (mutated here)\r\n */\n\n\nlib.fillText = function (calcPt, trace, contOut) {\n  var fill = Array.isArray(contOut) ? function (v) {\n    contOut.push(v);\n  } : function (v) {\n    contOut.text = v;\n  };\n  var htx = lib.extractOption(calcPt, trace, 'htx', 'hovertext');\n  if (lib.isValidTextValue(htx)) return fill(htx);\n  var tx = lib.extractOption(calcPt, trace, 'tx', 'text');\n  if (lib.isValidTextValue(tx)) return fill(tx);\n}; // accept all truthy values and 0 (which gets cast to '0' in the hover labels)\n\n\nlib.isValidTextValue = function (v) {\n  return v || v === 0;\n};\n/**\r\n * @param {number} ratio\r\n * @param {number} n (number of decimal places)\r\n */\n\n\nlib.formatPercent = function (ratio, n) {\n  n = n || 0;\n  var str = (Math.round(100 * ratio * Math.pow(10, n)) * Math.pow(0.1, n)).toFixed(n) + '%';\n\n  for (var i = 0; i < n; i++) {\n    if (str.indexOf('.') !== -1) {\n      str = str.replace('0%', '%');\n      str = str.replace('.%', '%');\n    }\n  }\n\n  return str;\n};\n\nlib.isHidden = function (gd) {\n  var display = window.getComputedStyle(gd).display;\n  return !display || display === 'none';\n};\n\nlib.strTranslate = function (x, y) {\n  return x || y ? 'translate(' + x + ',' + y + ')' : '';\n};\n\nlib.strRotate = function (a) {\n  return a ? 'rotate(' + a + ')' : '';\n};\n\nlib.strScale = function (s) {\n  return s !== 1 ? 'scale(' + s + ')' : '';\n};\n/** Return transform text for bar bar-like rectangles and pie-like slices\r\n *  @param {object} transform\r\n *  - targetX: desired position on the x-axis\r\n *  - targetY: desired position on the y-axis\r\n *  - textX: text middle position on the x-axis\r\n *  - textY: text middle position on the y-axis\r\n *  - anchorX: (optional) text anchor position on the x-axis (computed from textX), zero for middle anchor\r\n *  - anchorY: (optional) text anchor position on the y-axis (computed from textY), zero for middle anchor\r\n *  - scale: (optional) scale applied after translate\r\n *  - rotate: (optional) rotation applied after scale\r\n *  - noCenter: when defined no extra arguments needed in rotation\r\n */\n\n\nlib.getTextTransform = function (transform) {\n  var noCenter = transform.noCenter;\n  var textX = transform.textX;\n  var textY = transform.textY;\n  var targetX = transform.targetX;\n  var targetY = transform.targetY;\n  var anchorX = transform.anchorX || 0;\n  var anchorY = transform.anchorY || 0;\n  var rotate = transform.rotate;\n  var scale = transform.scale;\n  if (!scale) scale = 0;else if (scale > 1) scale = 1;\n  return lib.strTranslate(targetX - scale * (textX + anchorX), targetY - scale * (textY + anchorY)) + lib.strScale(scale) + (rotate ? 'rotate(' + rotate + (noCenter ? '' : ' ' + textX + ' ' + textY) + ')' : '');\n};\n\nlib.ensureUniformFontSize = function (gd, baseFont) {\n  var out = lib.extendFlat({}, baseFont);\n  out.size = Math.max(baseFont.size, gd._fullLayout.uniformtext.minsize || 0);\n  return out;\n};\n/**\r\n * provide a human-readable list e.g. \"A, B, C and D\" with an ending separator\r\n *\r\n * @param {array} arr : the array to join\r\n * @param {string} mainSeparator : main separator\r\n * @param {string} lastSeparator : last separator\r\n *\r\n * @return {string} : joined list\r\n */\n\n\nlib.join2 = function (arr, mainSeparator, lastSeparator) {\n  var len = arr.length;\n\n  if (len > 1) {\n    return arr.slice(0, -1).join(mainSeparator) + lastSeparator + arr[len - 1];\n  }\n\n  return arr.join(mainSeparator);\n};\n\nlib.bigFont = function (size) {\n  return Math.round(1.2 * size);\n};\n\nvar firefoxVersion = lib.getFirefoxVersion(); // see https://bugzilla.mozilla.org/show_bug.cgi?id=1684973\n\nvar isProblematicFirefox = firefoxVersion !== null && firefoxVersion < 86;\n/**\r\n * Return the mouse position from the last event registered by D3.\r\n * @returns An array with two numbers, representing the x and y coordinates of the mouse pointer\r\n *   at the event relative to the targeted node.\r\n */\n\nlib.getPositionFromD3Event = function () {\n  if (isProblematicFirefox) {\n    // layerX and layerY are non-standard, so we only fallback to them when we have to:\n    return [d3.event.layerX, d3.event.layerY];\n  } else {\n    return [d3.event.offsetX, d3.event.offsetY];\n  }\n};","map":{"version":3,"sources":["C:/Users/mikke/VSC/fantasy-django-react/fantasy-django/fantasy-react-app/node_modules/plotly.js/src/lib/index.js"],"names":["d3","require","utcFormat","isNumeric","numConstants","MAX_SAFE","FP_SAFE","MIN_SAFE","BADNUM","lib","module","exports","nestedProperty","keyedContainer","relativeAttr","isPlainObject","toLogRange","relinkPrivateKeys","arrayModule","isTypedArray","isArrayOrTypedArray","isArray1D","ensureArray","concat","maxRowLength","minRowLength","modModule","mod","modHalf","coerceModule","valObjectMeta","coerce","coerce2","coerceFont","coercePattern","coerceHoverinfo","coerceSelectionMarkerOpacity","validate","datesModule","dateTime2ms","isDateTime","ms2DateTime","ms2DateTimeLocal","cleanDate","isJSDate","formatDate","incrementMonth","dateTick0","dfltRange","findExactDates","MIN_MS","MAX_MS","searchModule","findBin","sorterAsc","sorterDes","distinctVals","roundUp","sort","findIndexOfMin","statsModule","aggNums","len","mean","median","midRange","variance","stdev","interp","matrixModule","init2dArray","transposeRagged","dot","translationMatrix","rotationMatrix","rotationXYMatrix","apply3DTransform","apply2DTransform","apply2DTransform2","convertCssMatrix","inverseTransformMatrix","anglesModule","deg2rad","rad2deg","angleDelta","angleDist","isFullCircle","isAngleInsideSector","isPtInsideSector","pathArc","pathSector","pathAnnulus","anchorUtils","isLeftAnchor","isCenterAnchor","isRightAnchor","isTopAnchor","isMiddleAnchor","isBottomAnchor","geom2dModule","segmentsIntersect","segmentDistance","getTextLocation","clearLocationCache","getVisibleSegment","findPointOnPath","extendModule","extendFlat","extendDeep","extendDeepAll","extendDeepNoArrays","loggersModule","log","warn","error","regexModule","counterRegex","counter","throttleModule","throttle","throttleDone","done","clearThrottle","clear","domModule","getGraphDiv","isPlotDiv","removeElement","addStyleRule","addRelatedStyleRule","deleteRelatedStyleRule","getFullTransformMatrix","getElementTransformMatrix","getElementAndAncestors","equalDomRects","clearResponsive","preserveDrawingBuffer","makeTraceGroups","_","notifier","filterUnique","filterVisible","pushUnique","increment","cleanNumber","ensureNumber","v","Number","isIndex","undefined","noop","identity","repeat","cnt","out","Array","i","swapAttrs","cont","attrList","part1","part2","length","attr","xp","replace","yp","temp","get","set","raiseToTop","elem","parentNode","appendChild","cancelTransition","selection","transition","duration","constrain","v0","v1","Math","max","min","bBoxIntersect","a","b","pad","left","right","top","bottom","simpleMap","array","func","x1","x2","opts","randstr","existing","bits","base","_recursion","digits","pow","res","x","Infinity","rem","floor","random","toString","parsed","parseInt","OptionControl","opt","optname","self","optionList","_newoption","optObj","name","push","smooth","arrayIn","FWHM","round","alen","alen2","wlen","w","arrayOut","j","k","cos","PI","syncOrAsync","sequence","arg","finalStep","ret","fni","continueAsync","splice","then","promiseError","stripTrailingSlash","str","substr","noneOrAll","containerIn","containerOut","hasAny","hasAll","val","mergeArray","traceAttr","cd","cdAttr","fn","hasFn","imax","mergeArrayCastPositive","isFinite","fillArray","castOption","trace","ptNumber","astr","isArray","extractOption","calcPt","calcKey","traceKey","traceVal","makePtIndex2PtNumber","indexToPoints","ptIndex2ptNumber","pts","tagSelected","calcTrace","ptNumber2cdIndex","selectedpoints","_indexToPoints","isCdIndexValid","ptIndex","cdIndex","selected","selIndices2selPoints","getTargetArray","transformOpts","target","minExtend","obj1","obj2","objOut","arrayLen","keys","Object","charAt","slice","subarray","titleCase","s","toUpperCase","containsAny","fragments","indexOf","isIE","window","navigator","msSaveBlob","IS_SAFARI_REGEX","isSafari","test","userAgent","IS_IOS_REGEX","isIOS","FIREFOX_VERSION_REGEX","getFirefoxVersion","match","exec","versionInt","isNaN","isD3Selection","obj","ensureSingle","parent","nodeType","className","enterFn","sel","select","size","layer","append","classed","call","ensureSingleById","id","objectFromPath","path","value","split","tmpObj","key","el","parts","dottedPropertyRegex","indexedPropertyRegex","expandObjectPaths","data","prop","datum","idx","dest","trailingPath","hasOwnProperty","numSeparate","separators","separatethousands","Error","String","thousandsRe","decimalSep","thouSep","TEMPLATE_STRING_REGEX","SIMPLE_PROPERTY_REGEX","templateString","string","getterCache","dummy","isValidTextValue","hovertemplateWarnings","count","hovertemplateString","templateFormatString","apply","arguments","texttemplateWarnings","texttemplateString","TEMPLATE_STRING_FORMAT_SEPARATOR","labels","d3locale","args","rawKey","format","isOther","isSpaceOther","isSpaceOtherSpace","isOtherSpace","hasOther","substring","fmt","numberFormat","timeFormat","ms","keyLabel","char0","char9","subplotSort","l","numA","numB","charA","charCodeAt","charB","isNumA","isNumB","randSeed","seedPseudoRandom","pseudoRandom","lastVal","abs","fillText","contOut","fill","text","htx","tx","formatPercent","ratio","n","toFixed","isHidden","gd","display","getComputedStyle","strTranslate","y","strRotate","strScale","getTextTransform","transform","noCenter","textX","textY","targetX","targetY","anchorX","anchorY","rotate","scale","ensureUniformFontSize","baseFont","_fullLayout","uniformtext","minsize","join2","arr","mainSeparator","lastSeparator","join","bigFont","firefoxVersion","isProblematicFirefox","getPositionFromD3Event","event","layerX","layerY","offsetX","offsetY"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar d3 = require('@plotly/d3');\r\nvar utcFormat = require('d3-time-format').utcFormat;\r\nvar isNumeric = require('fast-isnumeric');\r\n\r\nvar numConstants = require('../constants/numerical');\r\nvar MAX_SAFE = numConstants.FP_SAFE;\r\nvar MIN_SAFE = -MAX_SAFE;\r\nvar BADNUM = numConstants.BADNUM;\r\n\r\nvar lib = module.exports = {};\r\n\r\nlib.nestedProperty = require('./nested_property');\r\nlib.keyedContainer = require('./keyed_container');\r\nlib.relativeAttr = require('./relative_attr');\r\nlib.isPlainObject = require('./is_plain_object');\r\nlib.toLogRange = require('./to_log_range');\r\nlib.relinkPrivateKeys = require('./relink_private');\r\n\r\nvar arrayModule = require('./array');\r\nlib.isTypedArray = arrayModule.isTypedArray;\r\nlib.isArrayOrTypedArray = arrayModule.isArrayOrTypedArray;\r\nlib.isArray1D = arrayModule.isArray1D;\r\nlib.ensureArray = arrayModule.ensureArray;\r\nlib.concat = arrayModule.concat;\r\nlib.maxRowLength = arrayModule.maxRowLength;\r\nlib.minRowLength = arrayModule.minRowLength;\r\n\r\nvar modModule = require('./mod');\r\nlib.mod = modModule.mod;\r\nlib.modHalf = modModule.modHalf;\r\n\r\nvar coerceModule = require('./coerce');\r\nlib.valObjectMeta = coerceModule.valObjectMeta;\r\nlib.coerce = coerceModule.coerce;\r\nlib.coerce2 = coerceModule.coerce2;\r\nlib.coerceFont = coerceModule.coerceFont;\r\nlib.coercePattern = coerceModule.coercePattern;\r\nlib.coerceHoverinfo = coerceModule.coerceHoverinfo;\r\nlib.coerceSelectionMarkerOpacity = coerceModule.coerceSelectionMarkerOpacity;\r\nlib.validate = coerceModule.validate;\r\n\r\nvar datesModule = require('./dates');\r\nlib.dateTime2ms = datesModule.dateTime2ms;\r\nlib.isDateTime = datesModule.isDateTime;\r\nlib.ms2DateTime = datesModule.ms2DateTime;\r\nlib.ms2DateTimeLocal = datesModule.ms2DateTimeLocal;\r\nlib.cleanDate = datesModule.cleanDate;\r\nlib.isJSDate = datesModule.isJSDate;\r\nlib.formatDate = datesModule.formatDate;\r\nlib.incrementMonth = datesModule.incrementMonth;\r\nlib.dateTick0 = datesModule.dateTick0;\r\nlib.dfltRange = datesModule.dfltRange;\r\nlib.findExactDates = datesModule.findExactDates;\r\nlib.MIN_MS = datesModule.MIN_MS;\r\nlib.MAX_MS = datesModule.MAX_MS;\r\n\r\nvar searchModule = require('./search');\r\nlib.findBin = searchModule.findBin;\r\nlib.sorterAsc = searchModule.sorterAsc;\r\nlib.sorterDes = searchModule.sorterDes;\r\nlib.distinctVals = searchModule.distinctVals;\r\nlib.roundUp = searchModule.roundUp;\r\nlib.sort = searchModule.sort;\r\nlib.findIndexOfMin = searchModule.findIndexOfMin;\r\n\r\nvar statsModule = require('./stats');\r\nlib.aggNums = statsModule.aggNums;\r\nlib.len = statsModule.len;\r\nlib.mean = statsModule.mean;\r\nlib.median = statsModule.median;\r\nlib.midRange = statsModule.midRange;\r\nlib.variance = statsModule.variance;\r\nlib.stdev = statsModule.stdev;\r\nlib.interp = statsModule.interp;\r\n\r\nvar matrixModule = require('./matrix');\r\nlib.init2dArray = matrixModule.init2dArray;\r\nlib.transposeRagged = matrixModule.transposeRagged;\r\nlib.dot = matrixModule.dot;\r\nlib.translationMatrix = matrixModule.translationMatrix;\r\nlib.rotationMatrix = matrixModule.rotationMatrix;\r\nlib.rotationXYMatrix = matrixModule.rotationXYMatrix;\r\nlib.apply3DTransform = matrixModule.apply3DTransform;\r\nlib.apply2DTransform = matrixModule.apply2DTransform;\r\nlib.apply2DTransform2 = matrixModule.apply2DTransform2;\r\nlib.convertCssMatrix = matrixModule.convertCssMatrix;\r\nlib.inverseTransformMatrix = matrixModule.inverseTransformMatrix;\r\n\r\nvar anglesModule = require('./angles');\r\nlib.deg2rad = anglesModule.deg2rad;\r\nlib.rad2deg = anglesModule.rad2deg;\r\nlib.angleDelta = anglesModule.angleDelta;\r\nlib.angleDist = anglesModule.angleDist;\r\nlib.isFullCircle = anglesModule.isFullCircle;\r\nlib.isAngleInsideSector = anglesModule.isAngleInsideSector;\r\nlib.isPtInsideSector = anglesModule.isPtInsideSector;\r\nlib.pathArc = anglesModule.pathArc;\r\nlib.pathSector = anglesModule.pathSector;\r\nlib.pathAnnulus = anglesModule.pathAnnulus;\r\n\r\nvar anchorUtils = require('./anchor_utils');\r\nlib.isLeftAnchor = anchorUtils.isLeftAnchor;\r\nlib.isCenterAnchor = anchorUtils.isCenterAnchor;\r\nlib.isRightAnchor = anchorUtils.isRightAnchor;\r\nlib.isTopAnchor = anchorUtils.isTopAnchor;\r\nlib.isMiddleAnchor = anchorUtils.isMiddleAnchor;\r\nlib.isBottomAnchor = anchorUtils.isBottomAnchor;\r\n\r\nvar geom2dModule = require('./geometry2d');\r\nlib.segmentsIntersect = geom2dModule.segmentsIntersect;\r\nlib.segmentDistance = geom2dModule.segmentDistance;\r\nlib.getTextLocation = geom2dModule.getTextLocation;\r\nlib.clearLocationCache = geom2dModule.clearLocationCache;\r\nlib.getVisibleSegment = geom2dModule.getVisibleSegment;\r\nlib.findPointOnPath = geom2dModule.findPointOnPath;\r\n\r\nvar extendModule = require('./extend');\r\nlib.extendFlat = extendModule.extendFlat;\r\nlib.extendDeep = extendModule.extendDeep;\r\nlib.extendDeepAll = extendModule.extendDeepAll;\r\nlib.extendDeepNoArrays = extendModule.extendDeepNoArrays;\r\n\r\nvar loggersModule = require('./loggers');\r\nlib.log = loggersModule.log;\r\nlib.warn = loggersModule.warn;\r\nlib.error = loggersModule.error;\r\n\r\nvar regexModule = require('./regex');\r\nlib.counterRegex = regexModule.counter;\r\n\r\nvar throttleModule = require('./throttle');\r\nlib.throttle = throttleModule.throttle;\r\nlib.throttleDone = throttleModule.done;\r\nlib.clearThrottle = throttleModule.clear;\r\n\r\nvar domModule = require('./dom');\r\nlib.getGraphDiv = domModule.getGraphDiv;\r\nlib.isPlotDiv = domModule.isPlotDiv;\r\nlib.removeElement = domModule.removeElement;\r\nlib.addStyleRule = domModule.addStyleRule;\r\nlib.addRelatedStyleRule = domModule.addRelatedStyleRule;\r\nlib.deleteRelatedStyleRule = domModule.deleteRelatedStyleRule;\r\nlib.getFullTransformMatrix = domModule.getFullTransformMatrix;\r\nlib.getElementTransformMatrix = domModule.getElementTransformMatrix;\r\nlib.getElementAndAncestors = domModule.getElementAndAncestors;\r\nlib.equalDomRects = domModule.equalDomRects;\r\n\r\nlib.clearResponsive = require('./clear_responsive');\r\nlib.preserveDrawingBuffer = require('./preserve_drawing_buffer');\r\n\r\nlib.makeTraceGroups = require('./make_trace_groups');\r\n\r\nlib._ = require('./localize');\r\n\r\nlib.notifier = require('./notifier');\r\n\r\nlib.filterUnique = require('./filter_unique');\r\nlib.filterVisible = require('./filter_visible');\r\nlib.pushUnique = require('./push_unique');\r\n\r\nlib.increment = require('./increment');\r\n\r\nlib.cleanNumber = require('./clean_number');\r\n\r\nlib.ensureNumber = function ensureNumber(v) {\r\n    if(!isNumeric(v)) return BADNUM;\r\n    v = Number(v);\r\n    return (v > MAX_SAFE || v < MIN_SAFE) ? BADNUM : v;\r\n};\r\n\r\n/**\r\n * Is v a valid array index? Accepts numeric strings as well as numbers.\r\n *\r\n * @param {any} v: the value to test\r\n * @param {Optional[integer]} len: the array length we are indexing\r\n *\r\n * @return {bool}: v is a valid array index\r\n */\r\nlib.isIndex = function(v, len) {\r\n    if(len !== undefined && v >= len) return false;\r\n    return isNumeric(v) && (v >= 0) && (v % 1 === 0);\r\n};\r\n\r\nlib.noop = require('./noop');\r\nlib.identity = require('./identity');\r\n\r\n/**\r\n * create an array of length 'cnt' filled with 'v' at all indices\r\n *\r\n * @param {any} v\r\n * @param {number} cnt\r\n * @return {array}\r\n */\r\nlib.repeat = function(v, cnt) {\r\n    var out = new Array(cnt);\r\n    for(var i = 0; i < cnt; i++) {\r\n        out[i] = v;\r\n    }\r\n    return out;\r\n};\r\n\r\n/**\r\n * swap x and y of the same attribute in container cont\r\n * specify attr with a ? in place of x/y\r\n * you can also swap other things than x/y by providing part1 and part2\r\n */\r\nlib.swapAttrs = function(cont, attrList, part1, part2) {\r\n    if(!part1) part1 = 'x';\r\n    if(!part2) part2 = 'y';\r\n    for(var i = 0; i < attrList.length; i++) {\r\n        var attr = attrList[i];\r\n        var xp = lib.nestedProperty(cont, attr.replace('?', part1));\r\n        var yp = lib.nestedProperty(cont, attr.replace('?', part2));\r\n        var temp = xp.get();\r\n        xp.set(yp.get());\r\n        yp.set(temp);\r\n    }\r\n};\r\n\r\n/**\r\n * SVG painter's algo worked around with reinsertion\r\n */\r\nlib.raiseToTop = function raiseToTop(elem) {\r\n    elem.parentNode.appendChild(elem);\r\n};\r\n\r\n/**\r\n * cancel a possibly pending transition; returned selection may be used by caller\r\n */\r\nlib.cancelTransition = function(selection) {\r\n    return selection.transition().duration(0);\r\n};\r\n\r\n// constrain - restrict a number v to be between v0 and v1\r\nlib.constrain = function(v, v0, v1) {\r\n    if(v0 > v1) return Math.max(v1, Math.min(v0, v));\r\n    return Math.max(v0, Math.min(v1, v));\r\n};\r\n\r\n/**\r\n * do two bounding boxes from getBoundingClientRect,\r\n * ie {left,right,top,bottom,width,height}, overlap?\r\n * takes optional padding pixels\r\n */\r\nlib.bBoxIntersect = function(a, b, pad) {\r\n    pad = pad || 0;\r\n    return (a.left <= b.right + pad &&\r\n            b.left <= a.right + pad &&\r\n            a.top <= b.bottom + pad &&\r\n            b.top <= a.bottom + pad);\r\n};\r\n\r\n/*\r\n * simpleMap: alternative to Array.map that only\r\n * passes on the element and up to 2 extra args you\r\n * provide (but not the array index or the whole array)\r\n *\r\n * array: the array to map it to\r\n * func: the function to apply\r\n * x1, x2: optional extra args\r\n */\r\nlib.simpleMap = function(array, func, x1, x2, opts) {\r\n    var len = array.length;\r\n    var out = new Array(len);\r\n    for(var i = 0; i < len; i++) out[i] = func(array[i], x1, x2, opts);\r\n    return out;\r\n};\r\n\r\n/**\r\n * Random string generator\r\n *\r\n * @param {object} existing\r\n *     pass in strings to avoid as keys with truthy values\r\n * @param {int} bits\r\n *     bits of information in the output string, default 24\r\n * @param {int} base\r\n *     base of string representation, default 16. Should be a power of 2.\r\n */\r\nlib.randstr = function randstr(existing, bits, base, _recursion) {\r\n    if(!base) base = 16;\r\n    if(bits === undefined) bits = 24;\r\n    if(bits <= 0) return '0';\r\n\r\n    var digits = Math.log(Math.pow(2, bits)) / Math.log(base);\r\n    var res = '';\r\n    var i, b, x;\r\n\r\n    for(i = 2; digits === Infinity; i *= 2) {\r\n        digits = Math.log(Math.pow(2, bits / i)) / Math.log(base) * i;\r\n    }\r\n\r\n    var rem = digits - Math.floor(digits);\r\n\r\n    for(i = 0; i < Math.floor(digits); i++) {\r\n        x = Math.floor(Math.random() * base).toString(base);\r\n        res = x + res;\r\n    }\r\n\r\n    if(rem) {\r\n        b = Math.pow(base, rem);\r\n        x = Math.floor(Math.random() * b).toString(base);\r\n        res = x + res;\r\n    }\r\n\r\n    var parsed = parseInt(res, base);\r\n    if((existing && existing[res]) ||\r\n         (parsed !== Infinity && parsed >= Math.pow(2, bits))) {\r\n        if(_recursion > 10) {\r\n            lib.warn('randstr failed uniqueness');\r\n            return res;\r\n        }\r\n        return randstr(existing, bits, base, (_recursion || 0) + 1);\r\n    } else return res;\r\n};\r\n\r\nlib.OptionControl = function(opt, optname) {\r\n    /*\r\n     * An environment to contain all option setters and\r\n     * getters that collectively modify opts.\r\n     *\r\n     * You can call up opts from any function in new object\r\n     * as this.optname || this.opt\r\n     *\r\n     * See FitOpts for example of usage\r\n     */\r\n    if(!opt) opt = {};\r\n    if(!optname) optname = 'opt';\r\n\r\n    var self = {};\r\n    self.optionList = [];\r\n\r\n    self._newoption = function(optObj) {\r\n        optObj[optname] = opt;\r\n        self[optObj.name] = optObj;\r\n        self.optionList.push(optObj);\r\n    };\r\n\r\n    self['_' + optname] = opt;\r\n    return self;\r\n};\r\n\r\n/**\r\n * lib.smooth: smooth arrayIn by convolving with\r\n * a hann window with given full width at half max\r\n * bounce the ends in, so the output has the same length as the input\r\n */\r\nlib.smooth = function(arrayIn, FWHM) {\r\n    FWHM = Math.round(FWHM) || 0; // only makes sense for integers\r\n    if(FWHM < 2) return arrayIn;\r\n\r\n    var alen = arrayIn.length;\r\n    var alen2 = 2 * alen;\r\n    var wlen = 2 * FWHM - 1;\r\n    var w = new Array(wlen);\r\n    var arrayOut = new Array(alen);\r\n    var i;\r\n    var j;\r\n    var k;\r\n    var v;\r\n\r\n    // first make the window array\r\n    for(i = 0; i < wlen; i++) {\r\n        w[i] = (1 - Math.cos(Math.PI * (i + 1) / FWHM)) / (2 * FWHM);\r\n    }\r\n\r\n    // now do the convolution\r\n    for(i = 0; i < alen; i++) {\r\n        v = 0;\r\n        for(j = 0; j < wlen; j++) {\r\n            k = i + j + 1 - FWHM;\r\n\r\n            // multibounce\r\n            if(k < -alen) k -= alen2 * Math.round(k / alen2);\r\n            else if(k >= alen2) k -= alen2 * Math.floor(k / alen2);\r\n\r\n            // single bounce\r\n            if(k < 0) k = - 1 - k;\r\n            else if(k >= alen) k = alen2 - 1 - k;\r\n\r\n            v += arrayIn[k] * w[j];\r\n        }\r\n        arrayOut[i] = v;\r\n    }\r\n\r\n    return arrayOut;\r\n};\r\n\r\n/**\r\n * syncOrAsync: run a sequence of functions synchronously\r\n * as long as its returns are not promises (ie have no .then)\r\n * includes one argument arg to send to all functions...\r\n * this is mainly just to prevent us having to make wrapper functions\r\n * when the only purpose of the wrapper is to reference gd\r\n * and a final step to be executed at the end\r\n * TODO: if there's an error and everything is sync,\r\n * this doesn't happen yet because we want to make sure\r\n * that it gets reported\r\n */\r\nlib.syncOrAsync = function(sequence, arg, finalStep) {\r\n    var ret, fni;\r\n\r\n    function continueAsync() {\r\n        return lib.syncOrAsync(sequence, arg, finalStep);\r\n    }\r\n\r\n    while(sequence.length) {\r\n        fni = sequence.splice(0, 1)[0];\r\n        ret = fni(arg);\r\n\r\n        if(ret && ret.then) {\r\n            return ret.then(continueAsync)\r\n                .then(undefined, lib.promiseError);\r\n        }\r\n    }\r\n\r\n    return finalStep && finalStep(arg);\r\n};\r\n\r\n\r\n/**\r\n * Helper to strip trailing slash, from\r\n * http://stackoverflow.com/questions/6680825/return-string-without-trailing-slash\r\n */\r\nlib.stripTrailingSlash = function(str) {\r\n    if(str.substr(-1) === '/') return str.substr(0, str.length - 1);\r\n    return str;\r\n};\r\n\r\nlib.noneOrAll = function(containerIn, containerOut, attrList) {\r\n    /**\r\n     * some attributes come together, so if you have one of them\r\n     * in the input, you should copy the default values of the others\r\n     * to the input as well.\r\n     */\r\n    if(!containerIn) return;\r\n\r\n    var hasAny = false;\r\n    var hasAll = true;\r\n    var i;\r\n    var val;\r\n\r\n    for(i = 0; i < attrList.length; i++) {\r\n        val = containerIn[attrList[i]];\r\n        if(val !== undefined && val !== null) hasAny = true;\r\n        else hasAll = false;\r\n    }\r\n\r\n    if(hasAny && !hasAll) {\r\n        for(i = 0; i < attrList.length; i++) {\r\n            containerIn[attrList[i]] = containerOut[attrList[i]];\r\n        }\r\n    }\r\n};\r\n\r\n/** merges calcdata field (given by cdAttr) with traceAttr values\r\n *\r\n * N.B. Loop over minimum of cd.length and traceAttr.length\r\n * i.e. it does not try to fill in beyond traceAttr.length-1\r\n *\r\n * @param {array} traceAttr : trace attribute\r\n * @param {object} cd : calcdata trace\r\n * @param {string} cdAttr : calcdata key\r\n */\r\nlib.mergeArray = function(traceAttr, cd, cdAttr, fn) {\r\n    var hasFn = typeof fn === 'function';\r\n    if(lib.isArrayOrTypedArray(traceAttr)) {\r\n        var imax = Math.min(traceAttr.length, cd.length);\r\n        for(var i = 0; i < imax; i++) {\r\n            var v = traceAttr[i];\r\n            cd[i][cdAttr] = hasFn ? fn(v) : v;\r\n        }\r\n    }\r\n};\r\n\r\n// cast numbers to positive numbers, returns 0 if not greater than 0\r\nlib.mergeArrayCastPositive = function(traceAttr, cd, cdAttr) {\r\n    return lib.mergeArray(traceAttr, cd, cdAttr, function(v) {\r\n        var w = +v;\r\n        return !isFinite(w) ? 0 : w > 0 ? w : 0;\r\n    });\r\n};\r\n\r\n/** fills calcdata field (given by cdAttr) with traceAttr values\r\n *  or function of traceAttr values (e.g. some fallback)\r\n *\r\n * N.B. Loops over all cd items.\r\n *\r\n * @param {array} traceAttr : trace attribute\r\n * @param {object} cd : calcdata trace\r\n * @param {string} cdAttr : calcdata key\r\n * @param {function} [fn] : optional function to apply to each array item\r\n */\r\nlib.fillArray = function(traceAttr, cd, cdAttr, fn) {\r\n    fn = fn || lib.identity;\r\n\r\n    if(lib.isArrayOrTypedArray(traceAttr)) {\r\n        for(var i = 0; i < cd.length; i++) {\r\n            cd[i][cdAttr] = fn(traceAttr[i]);\r\n        }\r\n    }\r\n};\r\n\r\n/** Handler for trace-wide vs per-point options\r\n *\r\n * @param {object} trace : (full) trace object\r\n * @param {number} ptNumber : index of the point in question\r\n * @param {string} astr : attribute string\r\n * @param {function} [fn] : optional function to apply to each array item\r\n *\r\n * @return {any}\r\n */\r\nlib.castOption = function(trace, ptNumber, astr, fn) {\r\n    fn = fn || lib.identity;\r\n\r\n    var val = lib.nestedProperty(trace, astr).get();\r\n\r\n    if(lib.isArrayOrTypedArray(val)) {\r\n        if(Array.isArray(ptNumber) && lib.isArrayOrTypedArray(val[ptNumber[0]])) {\r\n            return fn(val[ptNumber[0]][ptNumber[1]]);\r\n        } else {\r\n            return fn(val[ptNumber]);\r\n        }\r\n    } else {\r\n        return val;\r\n    }\r\n};\r\n\r\n/** Extract option from calcdata item, correctly falling back to\r\n *  trace value if not found.\r\n *\r\n *  @param {object} calcPt : calcdata[i][j] item\r\n *  @param {object} trace : (full) trace object\r\n *  @param {string} calcKey : calcdata key\r\n *  @param {string} traceKey : aka trace attribute string\r\n *  @return {any}\r\n */\r\nlib.extractOption = function(calcPt, trace, calcKey, traceKey) {\r\n    if(calcKey in calcPt) return calcPt[calcKey];\r\n\r\n    // fallback to trace value,\r\n    //   must check if value isn't itself an array\r\n    //   which means the trace attribute has a corresponding\r\n    //   calcdata key, but its value is falsy\r\n    var traceVal = lib.nestedProperty(trace, traceKey).get();\r\n    if(!Array.isArray(traceVal)) return traceVal;\r\n};\r\n\r\nfunction makePtIndex2PtNumber(indexToPoints) {\r\n    var ptIndex2ptNumber = {};\r\n    for(var k in indexToPoints) {\r\n        var pts = indexToPoints[k];\r\n        for(var j = 0; j < pts.length; j++) {\r\n            ptIndex2ptNumber[pts[j]] = +k;\r\n        }\r\n    }\r\n    return ptIndex2ptNumber;\r\n}\r\n\r\n/** Tag selected calcdata items\r\n *\r\n * N.B. note that point 'index' corresponds to input data array index\r\n *  whereas 'number' is its post-transform version.\r\n *\r\n * @param {array} calcTrace\r\n * @param {object} trace\r\n *  - selectedpoints {array}\r\n *  - _indexToPoints {object}\r\n * @param {ptNumber2cdIndex} ptNumber2cdIndex (optional)\r\n *  optional map object for trace types that do not have 1-to-1 point number to\r\n *  calcdata item index correspondence (e.g. histogram)\r\n */\r\nlib.tagSelected = function(calcTrace, trace, ptNumber2cdIndex) {\r\n    var selectedpoints = trace.selectedpoints;\r\n    var indexToPoints = trace._indexToPoints;\r\n    var ptIndex2ptNumber;\r\n\r\n    // make pt index-to-number map object, which takes care of transformed traces\r\n    if(indexToPoints) {\r\n        ptIndex2ptNumber = makePtIndex2PtNumber(indexToPoints);\r\n    }\r\n\r\n    function isCdIndexValid(v) {\r\n        return v !== undefined && v < calcTrace.length;\r\n    }\r\n\r\n    for(var i = 0; i < selectedpoints.length; i++) {\r\n        var ptIndex = selectedpoints[i];\r\n\r\n        if(lib.isIndex(ptIndex) ||\r\n           (lib.isArrayOrTypedArray(ptIndex) && lib.isIndex(ptIndex[0]) && lib.isIndex(ptIndex[1]))\r\n        ) {\r\n            var ptNumber = ptIndex2ptNumber ? ptIndex2ptNumber[ptIndex] : ptIndex;\r\n            var cdIndex = ptNumber2cdIndex ? ptNumber2cdIndex[ptNumber] : ptNumber;\r\n\r\n            if(isCdIndexValid(cdIndex)) {\r\n                calcTrace[cdIndex].selected = 1;\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nlib.selIndices2selPoints = function(trace) {\r\n    var selectedpoints = trace.selectedpoints;\r\n    var indexToPoints = trace._indexToPoints;\r\n\r\n    if(indexToPoints) {\r\n        var ptIndex2ptNumber = makePtIndex2PtNumber(indexToPoints);\r\n        var out = [];\r\n\r\n        for(var i = 0; i < selectedpoints.length; i++) {\r\n            var ptIndex = selectedpoints[i];\r\n            if(lib.isIndex(ptIndex)) {\r\n                var ptNumber = ptIndex2ptNumber[ptIndex];\r\n                if(lib.isIndex(ptNumber)) {\r\n                    out.push(ptNumber);\r\n                }\r\n            }\r\n        }\r\n\r\n        return out;\r\n    } else {\r\n        return selectedpoints;\r\n    }\r\n};\r\n\r\n/** Returns target as set by 'target' transform attribute\r\n *\r\n * @param {object} trace : full trace object\r\n * @param {object} transformOpts : transform option object\r\n *  - target (string} :\r\n *      either an attribute string referencing an array in the trace object, or\r\n *      a set array.\r\n *\r\n * @return {array or false} : the target array (NOT a copy!!) or false if invalid\r\n */\r\nlib.getTargetArray = function(trace, transformOpts) {\r\n    var target = transformOpts.target;\r\n\r\n    if(typeof target === 'string' && target) {\r\n        var array = lib.nestedProperty(trace, target).get();\r\n        return Array.isArray(array) ? array : false;\r\n    } else if(Array.isArray(target)) {\r\n        return target;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * modified version of jQuery's extend to strip out private objs and functions,\r\n * and cut arrays down to first <arraylen> or 1 elements\r\n * because extend-like algorithms are hella slow\r\n * obj2 is assumed to already be clean of these things (including no arrays)\r\n */\r\nlib.minExtend = function(obj1, obj2) {\r\n    var objOut = {};\r\n    if(typeof obj2 !== 'object') obj2 = {};\r\n    var arrayLen = 3;\r\n    var keys = Object.keys(obj1);\r\n    var i, k, v;\r\n\r\n    for(i = 0; i < keys.length; i++) {\r\n        k = keys[i];\r\n        v = obj1[k];\r\n        if(k.charAt(0) === '_' || typeof v === 'function') continue;\r\n        else if(k === 'module') objOut[k] = v;\r\n        else if(Array.isArray(v)) {\r\n            if(k === 'colorscale') {\r\n                objOut[k] = v.slice();\r\n            } else {\r\n                objOut[k] = v.slice(0, arrayLen);\r\n            }\r\n        } else if(lib.isTypedArray(v)) {\r\n            objOut[k] = v.subarray(0, arrayLen);\r\n        } else if(v && (typeof v === 'object')) objOut[k] = lib.minExtend(obj1[k], obj2[k]);\r\n        else objOut[k] = v;\r\n    }\r\n\r\n    keys = Object.keys(obj2);\r\n    for(i = 0; i < keys.length; i++) {\r\n        k = keys[i];\r\n        v = obj2[k];\r\n        if(typeof v !== 'object' || !(k in objOut) || typeof objOut[k] !== 'object') {\r\n            objOut[k] = v;\r\n        }\r\n    }\r\n\r\n    return objOut;\r\n};\r\n\r\nlib.titleCase = function(s) {\r\n    return s.charAt(0).toUpperCase() + s.substr(1);\r\n};\r\n\r\nlib.containsAny = function(s, fragments) {\r\n    for(var i = 0; i < fragments.length; i++) {\r\n        if(s.indexOf(fragments[i]) !== -1) return true;\r\n    }\r\n    return false;\r\n};\r\n\r\nlib.isIE = function() {\r\n    return typeof window.navigator.msSaveBlob !== 'undefined';\r\n};\r\n\r\nvar IS_SAFARI_REGEX = /Version\\/[\\d\\.]+.*Safari/;\r\nlib.isSafari = function() {\r\n    return IS_SAFARI_REGEX.test(window.navigator.userAgent);\r\n};\r\n\r\nvar IS_IOS_REGEX = /iPad|iPhone|iPod/;\r\nlib.isIOS = function() {\r\n    return IS_IOS_REGEX.test(window.navigator.userAgent);\r\n};\r\n\r\nvar FIREFOX_VERSION_REGEX = /Firefox\\/(\\d+)\\.\\d+/;\r\nlib.getFirefoxVersion = function() {\r\n    var match = FIREFOX_VERSION_REGEX.exec(window.navigator.userAgent);\r\n    if(match && match.length === 2) {\r\n        var versionInt = parseInt(match[1]);\r\n        if(!isNaN(versionInt)) {\r\n            return versionInt;\r\n        }\r\n    }\r\n    return null;\r\n};\r\n\r\nlib.isD3Selection = function(obj) {\r\n    return obj instanceof d3.selection;\r\n};\r\n\r\n/**\r\n * Append element to DOM only if not present.\r\n *\r\n * @param {d3 selection} parent : parent selection of the element in question\r\n * @param {string} nodeType : node type of element to append\r\n * @param {string} className (optional) : class name of element in question\r\n * @param {fn} enterFn (optional) : optional fn applied to entering elements only\r\n * @return {d3 selection} selection of new layer\r\n *\r\n * Previously, we were using the following pattern:\r\n *\r\n * ```\r\n * var sel = parent.selectAll('.' + className)\r\n *     .data([0]);\r\n *\r\n * sel.enter().append(nodeType)\r\n *     .classed(className, true);\r\n *\r\n * return sel;\r\n * ```\r\n *\r\n * in numerous places in our codebase to achieve the same behavior.\r\n *\r\n * The logic below performs much better, mostly as we are using\r\n * `.select` instead `.selectAll` that is `querySelector` instead of\r\n * `querySelectorAll`.\r\n *\r\n */\r\nlib.ensureSingle = function(parent, nodeType, className, enterFn) {\r\n    var sel = parent.select(nodeType + (className ? '.' + className : ''));\r\n    if(sel.size()) return sel;\r\n\r\n    var layer = parent.append(nodeType);\r\n    if(className) layer.classed(className, true);\r\n    if(enterFn) layer.call(enterFn);\r\n\r\n    return layer;\r\n};\r\n\r\n/**\r\n * Same as Lib.ensureSingle, but using id as selector.\r\n * This version is mostly used for clipPath nodes.\r\n *\r\n * @param {d3 selection} parent : parent selection of the element in question\r\n * @param {string} nodeType : node type of element to append\r\n * @param {string} id : id of element in question\r\n * @param {fn} enterFn (optional) : optional fn applied to entering elements only\r\n * @return {d3 selection} selection of new layer\r\n */\r\nlib.ensureSingleById = function(parent, nodeType, id, enterFn) {\r\n    var sel = parent.select(nodeType + '#' + id);\r\n    if(sel.size()) return sel;\r\n\r\n    var layer = parent.append(nodeType).attr('id', id);\r\n    if(enterFn) layer.call(enterFn);\r\n\r\n    return layer;\r\n};\r\n\r\n/**\r\n * Converts a string path to an object.\r\n *\r\n * When given a string containing an array element, it will create a `null`\r\n * filled array of the given size.\r\n *\r\n * @example\r\n * lib.objectFromPath('nested.test[2].path', 'value');\r\n * // returns { nested: { test: [null, null, { path: 'value' }]}\r\n *\r\n * @param   {string}    path to nested value\r\n * @param   {*}         any value to be set\r\n *\r\n * @return {Object} the constructed object with a full nested path\r\n */\r\nlib.objectFromPath = function(path, value) {\r\n    var keys = path.split('.');\r\n    var tmpObj;\r\n    var obj = tmpObj = {};\r\n\r\n    for(var i = 0; i < keys.length; i++) {\r\n        var key = keys[i];\r\n        var el = null;\r\n\r\n        var parts = keys[i].match(/(.*)\\[([0-9]+)\\]/);\r\n\r\n        if(parts) {\r\n            key = parts[1];\r\n            el = parts[2];\r\n\r\n            tmpObj = tmpObj[key] = [];\r\n\r\n            if(i === keys.length - 1) {\r\n                tmpObj[el] = value;\r\n            } else {\r\n                tmpObj[el] = {};\r\n            }\r\n\r\n            tmpObj = tmpObj[el];\r\n        } else {\r\n            if(i === keys.length - 1) {\r\n                tmpObj[key] = value;\r\n            } else {\r\n                tmpObj[key] = {};\r\n            }\r\n\r\n            tmpObj = tmpObj[key];\r\n        }\r\n    }\r\n\r\n    return obj;\r\n};\r\n\r\n/**\r\n * Iterate through an object in-place, converting dotted properties to objects.\r\n *\r\n * Examples:\r\n *\r\n *   lib.expandObjectPaths({'nested.test.path': 'value'});\r\n *     => { nested: { test: {path: 'value'}}}\r\n *\r\n * It also handles array notation, e.g.:\r\n *\r\n *   lib.expandObjectPaths({'foo[1].bar': 'value'});\r\n *     => { foo: [null, {bar: value}] }\r\n *\r\n * It handles merges the results when two properties are specified in parallel:\r\n *\r\n *   lib.expandObjectPaths({'foo[1].bar': 10, 'foo[0].bar': 20});\r\n *     => { foo: [{bar: 10}, {bar: 20}] }\r\n *\r\n * It does NOT, however, merge multiple multiply-nested arrays::\r\n *\r\n *   lib.expandObjectPaths({'marker[1].range[1]': 5, 'marker[1].range[0]': 4})\r\n *     => { marker: [null, {range: 4}] }\r\n */\r\n\r\n// Store this to avoid recompiling regex on *every* prop since this may happen many\r\n// many times for animations. Could maybe be inside the function. Not sure about\r\n// scoping vs. recompilation tradeoff, but at least it's not just inlining it into\r\n// the inner loop.\r\nvar dottedPropertyRegex = /^([^\\[\\.]+)\\.(.+)?/;\r\nvar indexedPropertyRegex = /^([^\\.]+)\\[([0-9]+)\\](\\.)?(.+)?/;\r\n\r\nlib.expandObjectPaths = function(data) {\r\n    var match, key, prop, datum, idx, dest, trailingPath;\r\n    if(typeof data === 'object' && !Array.isArray(data)) {\r\n        for(key in data) {\r\n            if(data.hasOwnProperty(key)) {\r\n                if((match = key.match(dottedPropertyRegex))) {\r\n                    datum = data[key];\r\n                    prop = match[1];\r\n\r\n                    delete data[key];\r\n\r\n                    data[prop] = lib.extendDeepNoArrays(data[prop] || {}, lib.objectFromPath(key, lib.expandObjectPaths(datum))[prop]);\r\n                } else if((match = key.match(indexedPropertyRegex))) {\r\n                    datum = data[key];\r\n\r\n                    prop = match[1];\r\n                    idx = parseInt(match[2]);\r\n\r\n                    delete data[key];\r\n\r\n                    data[prop] = data[prop] || [];\r\n\r\n                    if(match[3] === '.') {\r\n                        // This is the case where theere are subsequent properties into which\r\n                        // we must recurse, e.g. transforms[0].value\r\n                        trailingPath = match[4];\r\n                        dest = data[prop][idx] = data[prop][idx] || {};\r\n\r\n                        // NB: Extend deep no arrays prevents this from working on multiple\r\n                        // nested properties in the same object, e.g.\r\n                        //\r\n                        // {\r\n                        //   foo[0].bar[1].range\r\n                        //   foo[0].bar[0].range\r\n                        // }\r\n                        //\r\n                        // In this case, the extendDeepNoArrays will overwrite one array with\r\n                        // the other, so that both properties *will not* be present in the\r\n                        // result. Fixing this would require a more intelligent tracking\r\n                        // of changes and merging than extendDeepNoArrays currently accomplishes.\r\n                        lib.extendDeepNoArrays(dest, lib.objectFromPath(trailingPath, lib.expandObjectPaths(datum)));\r\n                    } else {\r\n                        // This is the case where this property is the end of the line,\r\n                        // e.g. xaxis.range[0]\r\n                        data[prop][idx] = lib.expandObjectPaths(datum);\r\n                    }\r\n                } else {\r\n                    data[key] = lib.expandObjectPaths(data[key]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return data;\r\n};\r\n\r\n/**\r\n * Converts value to string separated by the provided separators.\r\n *\r\n * @example\r\n * lib.numSeparate(2016, '.,');\r\n * // returns '2016'\r\n *\r\n * @example\r\n * lib.numSeparate(3000, '.,', true);\r\n * // returns '3,000'\r\n *\r\n * @example\r\n * lib.numSeparate(1234.56, '|,')\r\n * // returns '1,234|56'\r\n *\r\n * @param   {string|number} value       the value to be converted\r\n * @param   {string}    separators  string of decimal, then thousands separators\r\n * @param   {boolean}    separatethousands  boolean, 4-digit integers are separated if true\r\n *\r\n * @return  {string}    the value that has been separated\r\n */\r\nlib.numSeparate = function(value, separators, separatethousands) {\r\n    if(!separatethousands) separatethousands = false;\r\n\r\n    if(typeof separators !== 'string' || separators.length === 0) {\r\n        throw new Error('Separator string required for formatting!');\r\n    }\r\n\r\n    if(typeof value === 'number') {\r\n        value = String(value);\r\n    }\r\n\r\n    var thousandsRe = /(\\d+)(\\d{3})/;\r\n    var decimalSep = separators.charAt(0);\r\n    var thouSep = separators.charAt(1);\r\n\r\n    var x = value.split('.');\r\n    var x1 = x[0];\r\n    var x2 = x.length > 1 ? decimalSep + x[1] : '';\r\n\r\n    // Years are ignored for thousands separators\r\n    if(thouSep && (x.length > 1 || x1.length > 4 || separatethousands)) {\r\n        while(thousandsRe.test(x1)) {\r\n            x1 = x1.replace(thousandsRe, '$1' + thouSep + '$2');\r\n        }\r\n    }\r\n\r\n    return x1 + x2;\r\n};\r\n\r\nlib.TEMPLATE_STRING_REGEX = /%{([^\\s%{}:]*)([:|\\|][^}]*)?}/g;\r\nvar SIMPLE_PROPERTY_REGEX = /^\\w*$/;\r\n\r\n/**\r\n * Substitute values from an object into a string\r\n *\r\n * Examples:\r\n *  Lib.templateString('name: %{trace}', {trace: 'asdf'}) --> 'name: asdf'\r\n *  Lib.templateString('name: %{trace[0].name}', {trace: [{name: 'asdf'}]}) --> 'name: asdf'\r\n *\r\n * @param {string}  input string containing %{...} template strings\r\n * @param {obj}     data object containing substitution values\r\n *\r\n * @return {string} templated string\r\n */\r\nlib.templateString = function(string, obj) {\r\n    // Not all that useful, but cache nestedProperty instantiation\r\n    // just in case it speeds things up *slightly*:\r\n    var getterCache = {};\r\n\r\n    return string.replace(lib.TEMPLATE_STRING_REGEX, function(dummy, key) {\r\n        var v;\r\n        if(SIMPLE_PROPERTY_REGEX.test(key)) {\r\n            v = obj[key];\r\n        } else {\r\n            getterCache[key] = getterCache[key] || lib.nestedProperty(obj, key).get;\r\n            v = getterCache[key]();\r\n        }\r\n        return lib.isValidTextValue(v) ? v : '';\r\n    });\r\n};\r\n\r\nvar hovertemplateWarnings = {\r\n    max: 10,\r\n    count: 0,\r\n    name: 'hovertemplate'\r\n};\r\nlib.hovertemplateString = function() {\r\n    return templateFormatString.apply(hovertemplateWarnings, arguments);\r\n};\r\n\r\nvar texttemplateWarnings = {\r\n    max: 10,\r\n    count: 0,\r\n    name: 'texttemplate'\r\n};\r\nlib.texttemplateString = function() {\r\n    return templateFormatString.apply(texttemplateWarnings, arguments);\r\n};\r\n\r\nvar TEMPLATE_STRING_FORMAT_SEPARATOR = /^[:|\\|]/;\r\n/**\r\n * Substitute values from an object into a string and optionally formats them using d3-format,\r\n * or fallback to associated labels.\r\n *\r\n * Examples:\r\n *  Lib.hovertemplateString('name: %{trace}', {trace: 'asdf'}) --> 'name: asdf'\r\n *  Lib.hovertemplateString('name: %{trace[0].name}', {trace: [{name: 'asdf'}]}) --> 'name: asdf'\r\n *  Lib.hovertemplateString('price: %{y:$.2f}', {y: 1}) --> 'price: $1.00'\r\n *\r\n * @param {string}  input string containing %{...:...} template strings\r\n * @param {obj}     data object containing fallback text when no formatting is specified, ex.: {yLabel: 'formattedYValue'}\r\n * @param {obj}     d3 locale\r\n * @param {obj}     data objects containing substitution values\r\n *\r\n * @return {string} templated string\r\n */\r\nfunction templateFormatString(string, labels, d3locale) {\r\n    var opts = this;\r\n    var args = arguments;\r\n    if(!labels) labels = {};\r\n    // Not all that useful, but cache nestedProperty instantiation\r\n    // just in case it speeds things up *slightly*:\r\n    var getterCache = {};\r\n\r\n    return string.replace(lib.TEMPLATE_STRING_REGEX, function(match, rawKey, format) {\r\n        var isOther =\r\n            rawKey === 'xother' ||\r\n            rawKey === 'yother';\r\n\r\n        var isSpaceOther =\r\n            rawKey === '_xother' ||\r\n            rawKey === '_yother';\r\n\r\n        var isSpaceOtherSpace =\r\n            rawKey === '_xother_' ||\r\n            rawKey === '_yother_';\r\n\r\n        var isOtherSpace =\r\n            rawKey === 'xother_' ||\r\n            rawKey === 'yother_';\r\n\r\n        var hasOther = isOther || isSpaceOther || isOtherSpace || isSpaceOtherSpace;\r\n\r\n        var key = rawKey;\r\n        if(isSpaceOther || isSpaceOtherSpace) key = key.substring(1);\r\n        if(isOtherSpace || isSpaceOtherSpace) key = key.substring(0, key.length - 1);\r\n\r\n        var value;\r\n        if(hasOther) {\r\n            value = labels[key];\r\n            if(value === undefined) return '';\r\n        } else {\r\n            var obj, i;\r\n            for(i = 3; i < args.length; i++) {\r\n                obj = args[i];\r\n                if(!obj) continue;\r\n                if(obj.hasOwnProperty(key)) {\r\n                    value = obj[key];\r\n                    break;\r\n                }\r\n\r\n                if(!SIMPLE_PROPERTY_REGEX.test(key)) {\r\n                    value = lib.nestedProperty(obj, key).get();\r\n                    value = getterCache[key] || lib.nestedProperty(obj, key).get();\r\n                    if(value) getterCache[key] = value;\r\n                }\r\n                if(value !== undefined) break;\r\n            }\r\n        }\r\n\r\n        if(value === undefined && opts) {\r\n            if(opts.count < opts.max) {\r\n                lib.warn('Variable \\'' + key + '\\' in ' + opts.name + ' could not be found!');\r\n                value = match;\r\n            }\r\n\r\n            if(opts.count === opts.max) {\r\n                lib.warn('Too many ' + opts.name + ' warnings - additional warnings will be suppressed');\r\n            }\r\n            opts.count++;\r\n\r\n            return match;\r\n        }\r\n\r\n        if(format) {\r\n            var fmt;\r\n            if(format[0] === ':') {\r\n                fmt = d3locale ? d3locale.numberFormat : d3.format;\r\n                value = fmt(format.replace(TEMPLATE_STRING_FORMAT_SEPARATOR, ''))(value);\r\n            }\r\n\r\n            if(format[0] === '|') {\r\n                fmt = d3locale ? d3locale.timeFormat : utcFormat;\r\n                var ms = lib.dateTime2ms(value);\r\n                value = lib.formatDate(ms, format.replace(TEMPLATE_STRING_FORMAT_SEPARATOR, ''), false, fmt);\r\n            }\r\n        } else {\r\n            var keyLabel = key + 'Label';\r\n            if(labels.hasOwnProperty(keyLabel)) value = labels[keyLabel];\r\n        }\r\n\r\n        if(hasOther) {\r\n            value = '(' + value + ')';\r\n            if(isSpaceOther || isSpaceOtherSpace) value = ' ' + value;\r\n            if(isOtherSpace || isSpaceOtherSpace) value = value + ' ';\r\n        }\r\n\r\n        return value;\r\n    });\r\n}\r\n\r\n/*\r\n * alphanumeric string sort, tailored for subplot IDs like scene2, scene10, x10y13 etc\r\n */\r\nvar char0 = 48;\r\nvar char9 = 57;\r\nlib.subplotSort = function(a, b) {\r\n    var l = Math.min(a.length, b.length) + 1;\r\n    var numA = 0;\r\n    var numB = 0;\r\n    for(var i = 0; i < l; i++) {\r\n        var charA = a.charCodeAt(i) || 0;\r\n        var charB = b.charCodeAt(i) || 0;\r\n        var isNumA = charA >= char0 && charA <= char9;\r\n        var isNumB = charB >= char0 && charB <= char9;\r\n\r\n        if(isNumA) numA = 10 * numA + charA - char0;\r\n        if(isNumB) numB = 10 * numB + charB - char0;\r\n\r\n        if(!isNumA || !isNumB) {\r\n            if(numA !== numB) return numA - numB;\r\n            if(charA !== charB) return charA - charB;\r\n        }\r\n    }\r\n    return numB - numA;\r\n};\r\n\r\n// repeatable pseudorandom generator\r\nvar randSeed = 2000000000;\r\n\r\nlib.seedPseudoRandom = function() {\r\n    randSeed = 2000000000;\r\n};\r\n\r\nlib.pseudoRandom = function() {\r\n    var lastVal = randSeed;\r\n    randSeed = (69069 * randSeed + 1) % 4294967296;\r\n    // don't let consecutive vals be too close together\r\n    // gets away from really trying to be random, in favor of better local uniformity\r\n    if(Math.abs(randSeed - lastVal) < 429496729) return lib.pseudoRandom();\r\n    return randSeed / 4294967296;\r\n};\r\n\r\n\r\n/** Fill hover 'pointData' container with 'correct' hover text value\r\n *\r\n * - If trace hoverinfo contains a 'text' flag and hovertext is not set,\r\n *   the text elements will be seen in the hover labels.\r\n *\r\n * - If trace hoverinfo contains a 'text' flag and hovertext is set,\r\n *   hovertext takes precedence over text\r\n *   i.e. the hoverinfo elements will be seen in the hover labels\r\n *\r\n *  @param {object} calcPt\r\n *  @param {object} trace\r\n *  @param {object || array} contOut (mutated here)\r\n */\r\nlib.fillText = function(calcPt, trace, contOut) {\r\n    var fill = Array.isArray(contOut) ?\r\n        function(v) { contOut.push(v); } :\r\n        function(v) { contOut.text = v; };\r\n\r\n    var htx = lib.extractOption(calcPt, trace, 'htx', 'hovertext');\r\n    if(lib.isValidTextValue(htx)) return fill(htx);\r\n\r\n    var tx = lib.extractOption(calcPt, trace, 'tx', 'text');\r\n    if(lib.isValidTextValue(tx)) return fill(tx);\r\n};\r\n\r\n// accept all truthy values and 0 (which gets cast to '0' in the hover labels)\r\nlib.isValidTextValue = function(v) {\r\n    return v || v === 0;\r\n};\r\n\r\n/**\r\n * @param {number} ratio\r\n * @param {number} n (number of decimal places)\r\n */\r\nlib.formatPercent = function(ratio, n) {\r\n    n = n || 0;\r\n    var str = (Math.round(100 * ratio * Math.pow(10, n)) * Math.pow(0.1, n)).toFixed(n) + '%';\r\n    for(var i = 0; i < n; i++) {\r\n        if(str.indexOf('.') !== -1) {\r\n            str = str.replace('0%', '%');\r\n            str = str.replace('.%', '%');\r\n        }\r\n    }\r\n    return str;\r\n};\r\n\r\nlib.isHidden = function(gd) {\r\n    var display = window.getComputedStyle(gd).display;\r\n    return !display || display === 'none';\r\n};\r\n\r\nlib.strTranslate = function(x, y) {\r\n    return (x || y) ? 'translate(' + x + ',' + y + ')' : '';\r\n};\r\n\r\nlib.strRotate = function(a) {\r\n    return a ? 'rotate(' + a + ')' : '';\r\n};\r\n\r\nlib.strScale = function(s) {\r\n    return s !== 1 ? 'scale(' + s + ')' : '';\r\n};\r\n\r\n/** Return transform text for bar bar-like rectangles and pie-like slices\r\n *  @param {object} transform\r\n *  - targetX: desired position on the x-axis\r\n *  - targetY: desired position on the y-axis\r\n *  - textX: text middle position on the x-axis\r\n *  - textY: text middle position on the y-axis\r\n *  - anchorX: (optional) text anchor position on the x-axis (computed from textX), zero for middle anchor\r\n *  - anchorY: (optional) text anchor position on the y-axis (computed from textY), zero for middle anchor\r\n *  - scale: (optional) scale applied after translate\r\n *  - rotate: (optional) rotation applied after scale\r\n *  - noCenter: when defined no extra arguments needed in rotation\r\n */\r\nlib.getTextTransform = function(transform) {\r\n    var noCenter = transform.noCenter;\r\n    var textX = transform.textX;\r\n    var textY = transform.textY;\r\n    var targetX = transform.targetX;\r\n    var targetY = transform.targetY;\r\n    var anchorX = transform.anchorX || 0;\r\n    var anchorY = transform.anchorY || 0;\r\n    var rotate = transform.rotate;\r\n    var scale = transform.scale;\r\n    if(!scale) scale = 0;\r\n    else if(scale > 1) scale = 1;\r\n\r\n    return (\r\n        lib.strTranslate(\r\n            targetX - scale * (textX + anchorX),\r\n            targetY - scale * (textY + anchorY)\r\n        ) +\r\n        lib.strScale(scale) +\r\n        (rotate ?\r\n            'rotate(' + rotate +\r\n                (noCenter ? '' : ' ' + textX + ' ' + textY) +\r\n            ')' : ''\r\n        )\r\n    );\r\n};\r\n\r\nlib.ensureUniformFontSize = function(gd, baseFont) {\r\n    var out = lib.extendFlat({}, baseFont);\r\n    out.size = Math.max(\r\n        baseFont.size,\r\n        gd._fullLayout.uniformtext.minsize || 0\r\n    );\r\n    return out;\r\n};\r\n\r\n/**\r\n * provide a human-readable list e.g. \"A, B, C and D\" with an ending separator\r\n *\r\n * @param {array} arr : the array to join\r\n * @param {string} mainSeparator : main separator\r\n * @param {string} lastSeparator : last separator\r\n *\r\n * @return {string} : joined list\r\n */\r\nlib.join2 = function(arr, mainSeparator, lastSeparator) {\r\n    var len = arr.length;\r\n    if(len > 1) {\r\n        return arr.slice(0, -1).join(mainSeparator) + lastSeparator + arr[len - 1];\r\n    }\r\n    return arr.join(mainSeparator);\r\n};\r\n\r\nlib.bigFont = function(size) {\r\n    return Math.round(1.2 * size);\r\n};\r\n\r\nvar firefoxVersion = lib.getFirefoxVersion();\r\n// see https://bugzilla.mozilla.org/show_bug.cgi?id=1684973\r\nvar isProblematicFirefox = firefoxVersion !== null && firefoxVersion < 86;\r\n\r\n/**\r\n * Return the mouse position from the last event registered by D3.\r\n * @returns An array with two numbers, representing the x and y coordinates of the mouse pointer\r\n *   at the event relative to the targeted node.\r\n */\r\nlib.getPositionFromD3Event = function() {\r\n    if(isProblematicFirefox) {\r\n        // layerX and layerY are non-standard, so we only fallback to them when we have to:\r\n        return [\r\n            d3.event.layerX,\r\n            d3.event.layerY\r\n        ];\r\n    } else {\r\n        return [\r\n            d3.event.offsetX,\r\n            d3.event.offsetY\r\n        ];\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}