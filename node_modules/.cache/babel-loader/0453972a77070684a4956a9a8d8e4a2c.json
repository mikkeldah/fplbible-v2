{"ast":null,"code":"'use strict';\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar Registry = require('../registry');\n\nvar Lib = require('../lib');\n\nvar helpers = require('./helpers');\n\nvar clonePlot = require('./cloneplot');\n\nvar toSVG = require('./tosvg');\n\nvar svgToImg = require('./svgtoimg');\n/**\r\n * @param {object} gd figure Object\r\n * @param {object} opts option object\r\n * @param opts.format 'jpeg' | 'png' | 'webp' | 'svg'\r\n */\n\n\nfunction toImage(gd, opts) {\n  // first clone the GD so we can operate in a clean environment\n  var ev = new EventEmitter();\n  var clone = clonePlot(gd, {\n    format: 'png'\n  });\n  var clonedGd = clone.gd; // put the cloned div somewhere off screen before attaching to DOM\n\n  clonedGd.style.position = 'absolute';\n  clonedGd.style.left = '-5000px';\n  document.body.appendChild(clonedGd);\n\n  function wait() {\n    var delay = helpers.getDelay(clonedGd._fullLayout);\n    setTimeout(function () {\n      var svg = toSVG(clonedGd);\n      var canvas = document.createElement('canvas');\n      canvas.id = Lib.randstr();\n      ev = svgToImg({\n        format: opts.format,\n        width: clonedGd._fullLayout.width,\n        height: clonedGd._fullLayout.height,\n        canvas: canvas,\n        emitter: ev,\n        svg: svg\n      });\n\n      ev.clean = function () {\n        if (clonedGd) document.body.removeChild(clonedGd);\n      };\n    }, delay);\n  }\n\n  var redrawFunc = helpers.getRedrawFunc(clonedGd);\n  Registry.call('_doPlot', clonedGd, clone.data, clone.layout, clone.config).then(redrawFunc).then(wait).catch(function (err) {\n    ev.emit('error', err);\n  });\n  return ev;\n}\n\nmodule.exports = toImage;","map":{"version":3,"sources":["C:/Users/mikke/VSC/fantasy-django-react/fantasy-django/fantasy-react-app/node_modules/plotly.js/src/snapshot/toimage.js"],"names":["EventEmitter","require","Registry","Lib","helpers","clonePlot","toSVG","svgToImg","toImage","gd","opts","ev","clone","format","clonedGd","style","position","left","document","body","appendChild","wait","delay","getDelay","_fullLayout","setTimeout","svg","canvas","createElement","id","randstr","width","height","emitter","clean","removeChild","redrawFunc","getRedrawFunc","call","data","layout","config","then","catch","err","emit","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,YAAY,GAAGC,OAAO,CAAC,QAAD,CAAP,CAAkBD,YAArC;;AAEA,IAAIE,QAAQ,GAAGD,OAAO,CAAC,aAAD,CAAtB;;AACA,IAAIE,GAAG,GAAGF,OAAO,CAAC,QAAD,CAAjB;;AAEA,IAAIG,OAAO,GAAGH,OAAO,CAAC,WAAD,CAArB;;AACA,IAAII,SAAS,GAAGJ,OAAO,CAAC,aAAD,CAAvB;;AACA,IAAIK,KAAK,GAAGL,OAAO,CAAC,SAAD,CAAnB;;AACA,IAAIM,QAAQ,GAAGN,OAAO,CAAC,YAAD,CAAtB;AAEA;AACA;AACA;AACA;AACA;;;AACA,SAASO,OAAT,CAAiBC,EAAjB,EAAqBC,IAArB,EAA2B;AACvB;AACA,MAAIC,EAAE,GAAG,IAAIX,YAAJ,EAAT;AAEA,MAAIY,KAAK,GAAGP,SAAS,CAACI,EAAD,EAAK;AAACI,IAAAA,MAAM,EAAE;AAAT,GAAL,CAArB;AACA,MAAIC,QAAQ,GAAGF,KAAK,CAACH,EAArB,CALuB,CAOvB;;AACAK,EAAAA,QAAQ,CAACC,KAAT,CAAeC,QAAf,GAA0B,UAA1B;AACAF,EAAAA,QAAQ,CAACC,KAAT,CAAeE,IAAf,GAAsB,SAAtB;AACAC,EAAAA,QAAQ,CAACC,IAAT,CAAcC,WAAd,CAA0BN,QAA1B;;AAEA,WAASO,IAAT,GAAgB;AACZ,QAAIC,KAAK,GAAGlB,OAAO,CAACmB,QAAR,CAAiBT,QAAQ,CAACU,WAA1B,CAAZ;AAEAC,IAAAA,UAAU,CAAC,YAAW;AAClB,UAAIC,GAAG,GAAGpB,KAAK,CAACQ,QAAD,CAAf;AAEA,UAAIa,MAAM,GAAGT,QAAQ,CAACU,aAAT,CAAuB,QAAvB,CAAb;AACAD,MAAAA,MAAM,CAACE,EAAP,GAAY1B,GAAG,CAAC2B,OAAJ,EAAZ;AAEAnB,MAAAA,EAAE,GAAGJ,QAAQ,CAAC;AACVM,QAAAA,MAAM,EAAEH,IAAI,CAACG,MADH;AAEVkB,QAAAA,KAAK,EAAEjB,QAAQ,CAACU,WAAT,CAAqBO,KAFlB;AAGVC,QAAAA,MAAM,EAAElB,QAAQ,CAACU,WAAT,CAAqBQ,MAHnB;AAIVL,QAAAA,MAAM,EAAEA,MAJE;AAKVM,QAAAA,OAAO,EAAEtB,EALC;AAMVe,QAAAA,GAAG,EAAEA;AANK,OAAD,CAAb;;AASAf,MAAAA,EAAE,CAACuB,KAAH,GAAW,YAAW;AAClB,YAAGpB,QAAH,EAAaI,QAAQ,CAACC,IAAT,CAAcgB,WAAd,CAA0BrB,QAA1B;AAChB,OAFD;AAGH,KAlBS,EAkBPQ,KAlBO,CAAV;AAmBH;;AAED,MAAIc,UAAU,GAAGhC,OAAO,CAACiC,aAAR,CAAsBvB,QAAtB,CAAjB;AAEAZ,EAAAA,QAAQ,CAACoC,IAAT,CAAc,SAAd,EAAyBxB,QAAzB,EAAmCF,KAAK,CAAC2B,IAAzC,EAA+C3B,KAAK,CAAC4B,MAArD,EAA6D5B,KAAK,CAAC6B,MAAnE,EACKC,IADL,CACUN,UADV,EAEKM,IAFL,CAEUrB,IAFV,EAGKsB,KAHL,CAGW,UAASC,GAAT,EAAc;AACjBjC,IAAAA,EAAE,CAACkC,IAAH,CAAQ,OAAR,EAAiBD,GAAjB;AACH,GALL;AAQA,SAAOjC,EAAP;AACH;;AAEDmC,MAAM,CAACC,OAAP,GAAiBvC,OAAjB","sourcesContent":["'use strict';\r\n\r\nvar EventEmitter = require('events').EventEmitter;\r\n\r\nvar Registry = require('../registry');\r\nvar Lib = require('../lib');\r\n\r\nvar helpers = require('./helpers');\r\nvar clonePlot = require('./cloneplot');\r\nvar toSVG = require('./tosvg');\r\nvar svgToImg = require('./svgtoimg');\r\n\r\n/**\r\n * @param {object} gd figure Object\r\n * @param {object} opts option object\r\n * @param opts.format 'jpeg' | 'png' | 'webp' | 'svg'\r\n */\r\nfunction toImage(gd, opts) {\r\n    // first clone the GD so we can operate in a clean environment\r\n    var ev = new EventEmitter();\r\n\r\n    var clone = clonePlot(gd, {format: 'png'});\r\n    var clonedGd = clone.gd;\r\n\r\n    // put the cloned div somewhere off screen before attaching to DOM\r\n    clonedGd.style.position = 'absolute';\r\n    clonedGd.style.left = '-5000px';\r\n    document.body.appendChild(clonedGd);\r\n\r\n    function wait() {\r\n        var delay = helpers.getDelay(clonedGd._fullLayout);\r\n\r\n        setTimeout(function() {\r\n            var svg = toSVG(clonedGd);\r\n\r\n            var canvas = document.createElement('canvas');\r\n            canvas.id = Lib.randstr();\r\n\r\n            ev = svgToImg({\r\n                format: opts.format,\r\n                width: clonedGd._fullLayout.width,\r\n                height: clonedGd._fullLayout.height,\r\n                canvas: canvas,\r\n                emitter: ev,\r\n                svg: svg\r\n            });\r\n\r\n            ev.clean = function() {\r\n                if(clonedGd) document.body.removeChild(clonedGd);\r\n            };\r\n        }, delay);\r\n    }\r\n\r\n    var redrawFunc = helpers.getRedrawFunc(clonedGd);\r\n\r\n    Registry.call('_doPlot', clonedGd, clone.data, clone.layout, clone.config)\r\n        .then(redrawFunc)\r\n        .then(wait)\r\n        .catch(function(err) {\r\n            ev.emit('error', err);\r\n        });\r\n\r\n\r\n    return ev;\r\n}\r\n\r\nmodule.exports = toImage;\r\n"]},"metadata":{},"sourceType":"script"}